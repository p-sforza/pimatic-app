!function(t){t.widget("mobile.timebox",{options:{dmin:!1,dmax:!1,step:!1,theme:!1,mini:null,repButton:!0,version:"0.1-2016-08-08",initSelector:"input[data-role='timebox']",clickEvent:"vclick",type:"horizontal"},_sbox_run:function(){var t=this,e=150;t.g.cnt>10&&(e=100),t.g.cnt>30&&(e=50),t.g.cnt>60&&(e=20),t.g.didRun=!0,t._offset(this,t.g.delta),t.g.cnt++,t.runButton=setTimeout(function(){t._sbox_run()},e)},_offset:function(t,e){var n,i,o,u,d,a,r,s,p,m,l=this,c=this.options;if(o=l.d.input.val(),/^([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(o)&&(u=parseInt(o.substring(0,o.indexOf(":"))),d=parseInt(o.substring(o.indexOf(":")+1)),a=parseInt(c.dmin.substring(0,o.indexOf(":"))),r=parseInt(c.dmin.substring(o.indexOf(":")+1)),s=parseInt(c.dmax.substring(0,o.indexOf(":"))),p=parseInt(c.dmax.substring(o.indexOf(":")+1)),m=!0,!l.disabled)){if(i=u,e<1){for(n=d-c.step;n<0;)n+=60,i-=1;i<0&&(i+=24),60*i+n<60*a+r&&(m=!1)}else{for(n=d+c.step;n>59;)n-=60,i+=1;i>23&&(i-=24),60*i+n>60*s+p&&(m=!1)}!0===m&&(n<10&&(n="0"+String(n)),i<10&&(i="0"+String(i)),l.d.input.val(String(i)+":"+String(n)).trigger("change"))}},_create:function(){var e=this,n=t.extend(this.options,this.element.data("options")),i={input:this.element,inputWrap:this.element.parent()},o=void 0!==window.ontouchstart,u={eStart:(o?"touchstart":"mousedown")+".timebox",eMove:(o?"touchmove":"mousemove")+".timebox",eEnd:(o?"touchend":"mouseup")+".timebox",eEndA:o?"mouseup.timebox touchend.timebox touchcancel.timebox touchmove.timebox":"mouseup.timebox mouseleave.timebox",move:!1,start:!1,end:!1,pos:!1,target:!1,delta:!1,tmp:!1,cnt:0};e.d=i,e.g=u,n.theme=!1===n.theme?t.mobile.getInheritedTheme(this.element,"a"):n.theme,e.d.input.prop("disabled")&&(n.disabled=!0),!1===n.dmin&&(n.dmin=!0===/([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(e.d.input.attr("min"))?e.d.input.attr("min"):"00:00"),!1===n.dmax&&(n.dmax=!0===/([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(e.d.input.attr("max"))?e.d.input.attr("max"):"23:59"),!1===n.step&&(n.step=void 0!==e.d.input.attr("step")?parseFloat(e.d.input.attr("step")):15),n.mini=null===n.mini?!!e.d.input.data("mini"):n.mini,e.d.wrap=t("<div>",{"data-role":"controlgroup","data-type":n.type,"data-mini":n.mini,"data-theme":n.theme}).insertBefore(e.d.inputWrap).append(e.d.inputWrap),e.d.inputWrap.addClass("ui-btn"),e.d.input.css({textAlign:"center"}),"vertical"!==n.type||(e.d.wrap.css({width:"auto"}),e.d.inputWrap.css({padding:0})),e.d.up=t("<div>",{class:"ui-btn ui-icon-plus ui-btn-icon-notext"}).html("&nbsp;"),e.d.down=t("<div>",{class:"ui-btn ui-icon-minus ui-btn-icon-notext"}).html("&nbsp;"),"vertical"!==n.type?e.d.wrap.prepend(e.d.down).append(e.d.up):e.d.wrap.prepend(e.d.up).append(e.d.down),e.d.wrap.controlgroup(),!1===n.repButton?(e.d.up.on(n.clickEvent,function(t){t.preventDefault(),e._offset(t.currentTarget,1)}),e.d.down.on(n.clickEvent,function(t){t.preventDefault(),e._offset(t.currentTarget,-1)})):(e.d.up.on(e.g.eStart,function(t){e.d.input.blur(),e._offset(t.currentTarget,1),e.g.move=!0,e.g.cnt=0,e.g.delta=1,e.runButton||(e.g.target=t.currentTarget,e.runButton=setTimeout(function(){e._sbox_run()},500))}),e.d.down.on(e.g.eStart,function(t){e.d.input.blur(),e._offset(t.currentTarget,-1),e.g.move=!0,e.g.cnt=0,e.g.delta=-1,e.runButton||(e.g.target=t.currentTarget,e.runButton=setTimeout(function(){e._sbox_run()},500))}),e.d.up.on(e.g.eEndA,function(t){e.g.move&&(t.preventDefault(),clearTimeout(e.runButton),e.runButton=!1,e.g.move=!1)}),e.d.down.on(e.g.eEndA,function(t){e.g.move&&(t.preventDefault(),clearTimeout(e.runButton),e.runButton=!1,e.g.move=!1)})),void 0!==t.event.special.mousewheel&&e.d.input.on("mousewheel",function(t,n){t.preventDefault(),e._offset(t.currentTarget,n<0?-1:1)}),n.disabled&&e.disable()},disable:function(){var t=this.d,e="ui-state-disabled";t.input.attr("disabled",!0).blur(),t.inputWrap.addClass(e),t.up.addClass(e),t.down.addClass(e),this.options.disabled=!0},enable:function(){var t=this.d,e="ui-state-disabled";t.input.attr("disabled",!1),t.inputWrap.removeClass(e),t.up.removeClass(e),t.down.removeClass(e),this.options.disabled=!1}})}(jQuery);