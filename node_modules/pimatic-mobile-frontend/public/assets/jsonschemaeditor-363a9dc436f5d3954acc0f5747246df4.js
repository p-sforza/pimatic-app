(function(){var e,r,t,n,a,i,l,u,o,s,p,c,m,f,d,v,h=[].indexOf||function(e){for(var r=0,t=this.length;r<t;r++)if(r in this&&this[r]===e)return r;return-1};v=function(e,r){var t,n,a,i,l,u,o,s;if(null==e)return ko.observable(r);switch(e.type){case"string":case"number":case"integer":case"boolean":return ko.observable(r);case"object":if(null==r)return ko.observable(r);if(null!=e.properties){o=e.properties;for(i in o)l=o[i],null==(u=r[i])&&null!=(null!=l?l.type:void 0)&&("array"!==(s=l.type)&&"object"!==s||(u=l.default)),r[i]=v(l,u)}return ko.observable(r);case"array":if(null==r)return ko.observableArray(r);for(t=n=0,a=r.length;n<a;t=++n)r[t],r[t]=v(e.items,r[t]);return ko.observableArray(r);default:return ko.observable(r)}},f=function(e){var r,t,n,a,i,l,u;if(null==(e=ko.unwrap(e)))return e;switch(u=e,Array.isArray(e)?"array":typeof e){case"object":u={};for(i in e)l=e[i],u[i]=f(l);break;case"array":for(u=[],t=n=0,a=e.length;n<a;t=++n)r=e[t],u[t]=f(r)}return u},p=function(e){return"string"==typeof e&&0===e.length||isNaN(e)},d=function(e,r,t,n){var a,i,l,u,o,s,c,m,f,v,h,y;if(null!=r)switch(e.type){case"string":case"boolean":break;case"object":if(e.properties&&null!=e.properties){c=e.properties,h=[];for(u in c)null!=(o=c[u]).definedBy&&null!=(a=r[o.definedBy])&&a in o.options&&(o=o.options[a]),null==(s=r[u])||"number"!==(m=o.type)&&"integer"!==m||(p(s)?t.push(u+" must be a number"):r[u]=parseFloat(s)),h.push(d(o,s,t,r));return h}break;case"array":if(null!=e.items){for(y=[],i=l=0,f=r.length;0<=f?l<f:l>f;i=0<=f?++l:--l)null==(s=r[i])||"number"!==(v=e.items.type)&&"integer"!==v||(p(s)?t.push(u+" must be a number"):r[i]=parseFloat(s)),y.push(d(e.items,s,t,r));return y}}},i=function(e){var r;if(null!=e.defaut)return e.default;if((null!=(r=e.enum)?r.length:void 0)>0)return e.enum[0];switch(e.type){case"string":return"";case"number":case"integer":return"";case"boolean":return!1;case"object":return{};case"array":return[]}},s=function(e){var r,t,n,a,l,u,o,s;if(null==e.schema.properties)return[];null==(a=ko.unwrap(e.value))&&(a={},e.value(a)),o=[],s=e.schema.properties;for(n in s)l=s[n],u=f(a[n]),null!=l.definedBy&&null!=(t=ko.unwrap(a[l.definedBy]))&&t in l.options&&((r=l).definedByValue=r.definedByValue||t,l=l.options[t],r.values=r.values||{},r.values[r.definedByValue]=u,r.definedByValue=t,u=r.values[t]),null==u&&null!=e.schema.required&&h.call(e.schema.required,n)>=0&&(u=i(l)),a[n]=v(l,u),o.push({schema:l,value:a[n]});return o},l=function(e){var r,t,n,i,l,u,o,s,p;if(null==e.schema.extraProperties)return[];null==(l=ko.unwrap(e.value))&&(l={},e.value(l)),r=e.schema.extraProperties(),t=!1;for(n in l)p=l[n],n in r||n in(e.schema.properties||{})||void 0!==(p=f(p))&&(a(i={type:typeof p,isExtra:!0},n),r[n]=i,t=!0);t&&e.schema.extraProperties(r),s=[];for(n in r)u=r[n],o=f(l[n]),l[n]=v(u,o),s.push({schema:u,value:l[n],parent:e});return s},o=function(e){var r;return null==ko.unwrap(e)?[]:function(){var t,n,a,i;for(i=[],t=0,n=(a=ko.unwrap(e)).length;t<n;t++)r=a[t],i.push({schema:this.items||{},value:r});return i}.call(this)},c=function(e,r){return r.schema.editingItem({schema:r.schema,value:v(r.schema,f(r.value)),index:e})},n=function(e,r){var t,n;return null!=(n=r.schema.editingItem()).index?((t=e.value())[n.index](n.value()),e.value(t)):e.value.push(n.value),r.schema.editingItem(null)},t=function(e){return e.schema.editingItem(null)},e=function(e){var r;r=null!=e.schema.items.default?v(e.schema.items,JSON.parse(JSON.stringify(e.schema.items.default))):v(e.schema.items,i(e.schema.items)),e.schema.items.editingItem({schema:e.schema.items,value:r})},r=function(e){var r,t,n,l,u;if(0!==(t=e.schema.newPropertyName()).length)return u=e.schema.newPropertyType(),l={type:u,isExtra:!0},a(l,t),n=e.value(),n[t]=i(l),e.value(n),r=e.schema.extraProperties(),r[t]=l,e.schema.extraProperties(r),e.schema.newPropertyName(""),e.schema.newPropertyType("string");alert("Name can not be empty")},m=function(e){var r,t,n;return t=e.schema.name,n=f(e.parent.value),delete n[t],r=e.parent.schema.extraProperties(),delete r[t],e.parent.value(n),e.parent.schema.extraProperties(r)},u=function(e){var r,t;return t=f(e),"object"===this.type&&null!=this.properties?(r="",null!=this.nameProperty&&null!=t[this.nameProperty]?r=t[this.nameProperty]:null!=this.properties.name?r=t.name:null!=this.properties.id&&(r.length>0?r+=" ("+t.id+")":r=t.id),null!=r&&r.length>0?r:JSON.stringify(t)):""+t},a=function(p,f){var d,v,y,b,g,P,k,w,x,j;switch(p.name=f,p.notDefault=function(e){return ko.pureComputed({read:function(){return null!=("function"==typeof e.value?e.value():void 0)},write:function(r){var t;return r?(null==(t=e.schema.default)&&(t=i(e.schema)),e.value(t)):e.value(void 0)}})},p.enabled=function(e){return null!=("function"==typeof e.value?e.value():void 0)},p.valueOrDefault=function(e){return ko.pureComputed({read:function(){return null!=("function"==typeof e.value?e.value():void 0)?e.value():e.schema.default},write:function(r){return e.value(r)}})},p.type){case"object":if(p.getProperties=s,p.allowAdditionalProperties=null==p.properties||"object"==typeof p.additionalProperties,p.allowAdditionalProperties&&(p.newPropertyName=ko.observable(""),p.newPropertyType=ko.observable("string"),"object"==typeof p.additionalProperties&&null!=p.additionalProperties.type?(p.extraPropertiesDescription=p.additionalProperties.description,p.newPropertyTypes=[p.additionalProperties.type]):p.newPropertyTypes=["string","number","boolean","object"],p.newPropertyAdd=r,p.extraProperties=ko.observable({}),p.getExtraProperties=l,p.removeExtraProperty=m),null!=p.properties){p.hasProperties=Object.keys(p.properties).length>0,k=p.properties;for(f in k)if(P=k[f],null!=p.required&&(P.notRequired=!(h.call(p.required,f)>=0)),a(P,f),null!=(null!=(w=P.defines)?w.property:void 0)){(d=p.properties[P.defines.property]).options=P.defines.options,d.definedBy=f,x=d.options;for(b in x)g=x[b],a(g,P.defines.property)}}else p.hasProperties=!1;break;case"array":p.getItems=o,null==p.items&&(p.items={}),p.items.getItemLabel=u,p.items.onEditItemClick=c,p.items.editOk=n,p.items.editCancel=t,p.items.addItem=e,p.items.editingItem=ko.observable(null),p.items.isSorting=ko.observable(!1),p.items.onSorted=function(e){return function(r,t,n){var a,i,l,u,o,s;for(l=0,o=0,a=e.value(),r=r.value(),t=null!=t?t.value():null,n=null!=n?n.value():null,i=u=0,s=a.length;0<=s?u<s:u>s;i=0<=s?++u:--u)a[i]()===r&&(l=i),a[i]()===n&&(o=i-1);if(null==t&&(o=0),null==n&&(o=a.length-1),l!==o)return a.splice(l,1),a.splice(o,0,ko.observable(r)),e.value(a)}},p.items.onRemove=function(e){return function(r){var t,n,a,i;for(t=e.value(),r=r.value(),n=a=0,i=t.length;0<=i?a<i:a>i;n=0<=i?++a:--a)if(t[n]()===r)return t.splice(n,1),void e.value(t)}},v=p.items.name||f+" Item",null!=f&&null!=(y=f.match(/^(.+)s/))&&(v=y[1]),a(p.items,v);break;case"string":case"number":case"integer":case"boolean":null!=(null!=(j=p.defines)?j.options:void 0)&&null==p.enum&&(p.enum=Object.keys(p.defines.options))}},window.jsonschemaeditor={wrap:v,unwrap:f,enhanceSchema:a,validate:d}}).call(this);