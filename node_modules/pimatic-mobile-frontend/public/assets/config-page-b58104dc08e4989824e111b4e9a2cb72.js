(function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}};e=Array.prototype.concat,LazyLoad.js(e.apply(scripts.editor)),LazyLoad.css(e.apply(styles.editor)),$(document).on("pagecreate","#config-page",function(e){var o,n,i;o=function(){function e(){this.updateConfigClicked=t(this.updateConfigClicked,this);var e,o,n;n=this,e=$("#config-editor")[0],o=JSONEditor.prototype.setMode,JSONEditor.prototype.setMode=function(e){var t;return t=o.call(this,e),n.mode(e),t},ko.computed(function(e){return function(){var t,o,n,i,r,c;if("code"===(t=e.mode())&&(null!=(o=e.editor)&&o.editor.setReadOnly(e.locked()),e.locked()?$("#config-editor .ace_content").addClass("readonly"):$("#config-editor .ace_content").removeClass("readonly")),"view"===t&&(null!=(n=e.editor)&&(n.modes=["tree","code"]),e.locked()||null!=(i=e.editor)&&i.setMode("tree")),"tree"===t&&(null!=(r=e.editor)&&(r.modes=["view","code"]),e.locked()))return null!=(c=e.editor)?c.setMode("view"):void 0}}(this)),this.editor=new JSONEditor(e,{mode:"code",modes:["view","code"]}),this.editor.editor.setReadOnly(!0),$("#config-editor .ace_content").addClass("readonly"),this.getConfig(),this.config.subscribe(function(e){return function(t){return e.editor.set(t)}}(this)),this.lockButton=ko.computed(function(e){return function(){var t;return t=e.locked(),{icon:t?"gear":"delete",text:t?__("Edit"):__("Cancel")}}}(this)),$.mobile.document.on("pagebeforechange",function(e){return function(t,o){var n;return!((null!=(n=o.options.fromPage)?n.is("#config-page"):void 0)&&!e.locked())||(swal({title:"Discard all changes?",text:"If you leave the page all unsaved changes will be lost, continue?",type:"warning",showCancelButton:!0,confirmButtonText:"Continue",closeOnConfirm:!0}).then(function(){return e.locked(!0),$.mobile.pageContainer.pagecontainer("change",o.toPage,{options:o.options})}),t.preventDefault(),!1)}}(this))}return e.prototype.config=ko.observable(""),e.prototype.mode=ko.observable(""),e.prototype.locked=ko.observable(!0),e.prototype.toggleLock=function(){return this.locked()?swal({type:"question",title:"Unlock",text:"Please Enter your password to unlock the config page:",inputPlaceholder:"Password",inputValue:"",input:"password"}).then(function(e){return function(t){return pimatic.client.rest.getConfig({password:t}).done(function(t){e.config(t.config),e.locked(!1)}).fail(ajaxAlertFail)}}(this)):pimatic.client.rest.getConfig({}).done(function(e){return function(t){e.config(t.config),e.locked(!0)}}(this)).fail(ajaxAlertFail)},e.prototype.getConfig=function(){return pimatic.client.rest.getConfig({}).done(function(e){return function(t){e.config(t.config)}}(this)).fail(ajaxAlertFail)},e.prototype.updateConfigClicked=function(){return swal({title:"Are you sure?",text:"pimatic will be restarted after the config was changed!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes",closeOnConfirm:!1}).then(function(e){return function(){var t,o;try{return t=e.editor.get(),pimatic.client.rest.updateConfig({config:t}).done(function(){return swal("Restarting","Config seems to be valid, restarting...","success"),e.locked(!0)}).fail(ajaxAlertFail).fail()}catch(e){return o=e,swal("Oops...",o,"error")}}}(this))},e}();try{pimatic.pages.config=n=new o,ko.applyBindings(n,$("#config-page")[0])}catch(e){i=e,TraceKit.report(i)}}),$(document).on("pagehide","#config-page",function(e){var t,o;try{if(null!=(t=pimatic.pages.config).editor)return t.config(null)}catch(e){return o=e,TraceKit.report(o)}}),$(document).on("pageshow","#config-page",function(e){var t,o;try{if(null!=(t=pimatic.pages.config).editor&&null==t.config())return t.getConfig()}catch(e){return o=e,TraceKit.report(o)}})}).call(this);