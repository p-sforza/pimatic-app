(function(){var t,e,r,i,n,o,u,a=function(t,e){return function(){return t.apply(e,arguments)}},s=[].indexOf||function(t){for(var e=0,r=this.length;e<r;e++)if(e in this&&this[e]===t)return e;return-1};ko.mapper.handlers.callback={fromJS:function(t,e,r,i){return null==r?e.$create(t):e.$update(t,r)},toJS:function(t,e){return t.toJS()}},ko.mapper.handlers.observe=ko.mapper.handlers.value,function(){var t,e,r;e=humanFormat.makePrefixes("y,z,a,f,p,n,µ,m,,k,M,G,T,P,E,Z,Y".split(","),1e3,-8),r=humanFormat.makePrefixes(",k".split(","),1e3,0),t=humanFormat.makePrefixes("m,c,d,".split(","),10,-3),humanFormat.unitPrefixes={B:e,W:r,Wh:r,m:t}}(),e=function(){function t(t,e){this.device=e,this.tooltipFormatter=a(this.tooltipFormatter,this),this.tooltipHtml=a(this.tooltipHtml,this),null==t.value&&(t.value=null),this.history=ko.observableArray([]),this.lastUpdate=ko.observable(0),ko.mapper.fromJS(t,this.constructor.mapping,this),this.unitText=null!=this.unit?this.unit:"","number"===this.type&&(this.sparklineHistory=ko.pureComputed(function(t){return function(){var e,r,i,n,o,u,a;for(o=[],e=0,r=(i=t.history()).length;e<r;e++)u=(n=i[e]).t,a=n.v,o.push([u,a]);return o}}(this)))}return t.mapping={$default:"ignore",description:"copy",label:"copy",acronym:"copy",labels:"copy",name:"copy",type:"copy",value:"observe",unit:"copy",history:"observe",lastUpdate:"observe",displaySparkline:"observe",displayUnit:"copy",discrete:"copy",icon:"copy",hidden:"copy"},t.prototype.shouldDisplaySparkline=function(){return"number"===this.type&&this.history().length>1&&(null==this.displaySparkline||null==this.displaySparkline()||this.displaySparkline())},t.prototype.tooltipHtml=function(){var t;return this.label+": "+this.formatValue(this.value())+" "+this.lastUpdateTimeText()+("number"===(t=this.type)||"boolean"===t?'<a href="#" id="to-graph-page"\n  data-attributeName="'+this.name+'"\n  data-deviceId="'+this.device.id+'">'+__("Graph")+"</a>":"")+'<a href="#" id="to-device-editor-page"\ndata-deviceId="'+this.device.id+'">'+__("Edit Device")+"</a>"},t.prototype.outOfDate=function(){var t,e;return"number"===this.type&&(e=(new Date).getTime(),t=this.lastUpdate(),e-t>18e5)},t.prototype.lastUpdateTimeText=function(){return" @ "+this.formatTime(this.lastUpdate())},t.prototype.tooltipFormatter=function(t,e,r){var i,n;return n=this.formatValue(r.y),i=this.formatTime(r.x),"<span>"+n+" @ "+i+"</span>"},t.prototype.update=function(t){return ko.mapper.fromJS(t,this.constructor.mapping,this)},t.prototype.updateValue=function(t,e){return this.value(e),this.lastUpdate(t),30===this.history().length&&this.history.shift(),this.history.push({t:t,v:e})},t.prototype.displayValueText=function(){var t;return null==(t=this.value())?__("unknown"):"number"===this.type?this._getNumberFormat(t).num:this.formatValue(t)},t.prototype.displayUnitText=function(){var t;return"number"===this.type?(t=this.value(),this._getNumberFormat(t).unit):""},t.prototype.shouldDisplayAcronym=function(){var t;return(null!=(t=this.acronym)?t.length:void 0)>0},t.prototype.displayAcronym=function(){return this.acronym||""},t.prototype.formatValue=function(t){var e;switch(this.type){case"boolean":return this.labels?!0===t?__(this.labels[0]):__(this.labels[1]):t.toString();case"string":return t;case"number":return(e=this._getNumberFormat(t)).num+" "+e.unit;default:return t.toString()}},t.prototype._getNumberFormat=function(t){var e,r,i,n,o,u;if(n=this.unit,s.call(Object.keys(humanFormat.unitPrefixes),n)>=0)return i=null!=this.displayUnit&&null!=this.unit?this.displayUnit.substring(0,this.displayUnit.length-this.unit.length):null,e=humanFormat.humanFormatInfo(t,{unit:this.unit,prefixes:humanFormat.unitPrefixes[this.unit],prefix:i}),"W"!==(o=e.unit)&&"Wh"!==o||"k"!==e.prefix?"m"===e.unit&&""===e.prefix&&t>=1e3&&(e.num=Math.round(t/100)/10,e.prefix="k"):(e.num=Math.round(t)/1e3,e.num=e.num.toFixed(3)),{num:e.num,unit:e.prefix+e.unit};if("kW"===(u=this.unit)||"kWh"===u)r=(r=Math.round(1e3*t)/1e3).toFixed(3);else{if("s"===this.unit)return r=pimatic.toHHMMSS(t),{num:r,unit:""};r=Math.round(100*t)/100}return{num:r,unit:this.unit||""}},t.prototype.shouldDisplayValue=function(){var t;return null!=(t=this.icon)?!t.noText:!0},t.prototype.shouldDisplayIcon=function(){return null!=this.icon&&null!=this.value()},t.prototype._getIconClass=function(t){var e,r,i,n;if(null==this.icon)return null;if(r=null,null!=this.icon.mapping){i=this.icon.mapping;for(e in i)if(n=i[e],$.isArray(n)&&2===n.length){if(n[0]<=t&&t<n[1]){r=e;break}}else if(n===t){r=e;break}}return null==r&&(r=this.icon.default),r},t.prototype.getIconClass=function(){return this._getIconClass(this.value())},t.prototype.formatTime=function(t){var e,r;return e=pimatic.timestampToDateTime(t),r=pimatic.timestampToDateTime(new Date),e.date!==r.date?e.date+" "+e.time:e.time},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t}(),t=function(){function t(e){var r,i,n,o;for(t.mapping.device=this,ko.mapper.fromJS(e,this.constructor.mapping,this),this.configObserve=ko.observable(e.config),this.rest={},i=0,n=(o=this.actions).length;i<n;i++)r=o[i],pimatic.client.createRestAction(this.rest,r.name,r,{type:"get",url:"/api/device/"+this.id+"/"+r.name});this.group=ko.pureComputed(function(t){return function(){return"null"===t.id?null:pimatic.getGroupOfDevice(t.id)}}(this)),this.configWithDefaults=ko.pureComputed(function(t){return function(){var e,r,i,n,o;o={},i=t.configDefaults;for(r in i)e=i[r],o[r]=e;n=t.configObserve();for(r in n)e=n[r],o[r]=e;return o}}(this))}return t.mapping={$default:"ignore",name:"observe",config:"copy",configDefaults:"copy",id:"copy",template:"copy",actions:"copy",attributes:{$key:"name",$itemOptions:{$handler:"callback",$create:function(r){return new e(r,t.mapping.device)},$update:function(t,e){return e.update(t),e}}}},t.prototype.update=function(e){return t.mapping.device=this,ko.mapper.fromJS(e,this.constructor.mapping,this),this.configObserve(e.config)},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t.prototype.getAttribute=function(t){return ko.utils.arrayFirst(this.attributes(),function(e){return e.name===t})},t.prototype.updateAttribute=function(t,e,r){var i;if(null!=(i=this.getAttribute(t)))return i.updateValue(e,r)},t.prototype.hasAttibuteWith=function(t){var e,r,i,n;for(r=0,i=(n=this.attributes()).length;r<i;r++)if(e=n[r],t(e))return!0;return!1},t}(),o=function(){function t(t){ko.mapper.fromJS(t,this.constructor.mapping,this),this.group=ko.pureComputed(function(t){return function(){return pimatic.getGroupOfRule(t.id)}}(this))}return t.mapping={$default:"ignore",id:"copy",name:"observe",string:"observe",actionsToken:"observe",conditionToken:"observe",error:"observe",active:"observe",logging:"observe",valid:"observe"},t.prototype.update=function(t){return ko.mapper.fromJS(t,this.constructor.mapping,this)},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t}(),u=function(){function t(t){null==t.value&&(t.value=null),null==t.exprInputStr&&(t.exprInputStr=null),null==t.exprTokens&&(t.exprTokens=null),ko.mapper.fromJS(t,this.constructor.mapping,this),this.displayName=ko.pureComputed(function(t){return function(){return"$"+t.name}}(this)),this.hasValue=ko.pureComputed(function(t){return function(){return null!=t.value()}}(this)),this.displayValue=ko.pureComputed(function(t){return function(){return t.hasValue()?t.value():"null"}}(this)),this.group=ko.pureComputed(function(t){return function(){return pimatic.getGroupOfVariable(t.name)}}(this))}return t.mapping={$default:"ignore",exprInputStr:"observe",exprTokens:"observe",name:"copy",readonly:"observe",type:"observe",value:"observe",unit:"observe"},t.prototype.isDeviceAttribute=function(){return-1!==$.inArray(".",this.name)},t.prototype.update=function(t){return ko.mapper.fromJS(t,this.constructor.mapping,this)},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t}(),r=function(){function t(t){ko.mapper.fromJS(t,this.constructor.mapping,this),this.deviceByGroups=ko.pureComputed(function(t){return function(){var e,r,i,n,o,u,a;for(u={$ungrouped:[]},n=0,o=(a=t.devices()).length;n<o;n++)(e=a[n]).device!==pimatic.nullDevice&&(null!=u[i=(null!=(r=pimatic.getGroupOfDevice(e.device.id))?r.id:void 0)||"$ungrouped"]?u[i].push(e):u[i]=[e]);return u}}(this))}return t.mapping={$default:"ignore",id:"copy",name:"observe",devices:{$key:"deviceId",$itemOptions:{$handler:"callback",$create:function(t){var e,r;return null==(e=pimatic.getDeviceById(t.deviceId))&&(e=pimatic.nullDevice),null==(r=pimatic.templateClasses[e.template])&&(console.warn("Could not find a template class for "+e.template),r=pimatic.DeviceItem),null==e?console.error("Device should never be null"):new r(t,e)},$update:function(t,e){return e.update(t),e}}}},t.prototype.getDevicesInGroup=function(t){return this.deviceByGroups()[t]||[]},t.prototype.getUngroupedDevices=function(){return this.deviceByGroups().$ungrouped},t.prototype.update=function(t){return ko.mapper.fromJS(t,this.constructor.mapping,this)},t.prototype.getDeviceTemplate=function(t){return t.getDeviceTemplate()},t.prototype.afterRenderDevice=function(t,e){return e.afterRender(t)},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t}(),i=function(){function t(t){ko.mapper.fromJS(t,this.constructor.mapping,this),this.getDevices=ko.pureComputed(function(t){return function(){var e,r,i,n,o,u;for(i=[],n=0,o=(u=t.devices()).length;n<o;n++)e=u[n],null!=(r=pimatic.getDeviceById(e))&&i.push(r);return i}}(this)),this.getRules=ko.pureComputed(function(t){return function(){var e,r,i,n,o,u;for(u=[],e=0,r=(i=t.rules()).length;e<r;e++)n=i[e],null!=(o=pimatic.getRuleById(n))&&u.push(o);return u}}(this)),this.getVariables=ko.pureComputed(function(t){return function(){var e,r,i,n,o,u;for(u=[],e=0,r=(i=t.variables()).length;e<r;e++)n=i[e],null!=(o=pimatic.getVariableByName(n))&&u.push(o);return u}}(this))}return t.mapping={$default:"ignore",id:"copy",name:"observe",rules:"array",devices:"array",variables:"array"},t.prototype.update=function(t){return ko.mapper.fromJS(t,this.constructor.mapping,this)},t.prototype.getDevicesWithAttibute=function(t){var e;return function(){var r,i,n,o;for(o=[],r=0,i=(n=this.getDevices()).length;r<i;r++)(e=n[r]).hasAttibuteWith(t)&&o.push(e);return o}.call(this)},t.prototype.getDevicesWithGraphableAttribute=function(){return this.getDevicesWithAttibute(function(t){var e;return"number"===(e=t.type)||"boolean"===e})},t.prototype.containsDevice=function(t){return-1!==ko.utils.arrayIndexOf(this.devices(),t)},t.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},t}(),n=function(){function e(){this.isDemo=a(this.isDemo,this),this.hasPermission=a(this.hasPermission,this),window.pimatic=this,this.client=new DeclApiClient(api),this.updateFromJs({devices:[],rules:[],variables:[],devicepages:[],groups:[],errorCount:0,rememberme:!1,updateProcessStatus:"idle",updateProcessMessages:[],guiSettings:null,username:null,role:null,permissions:[{pages:"none",rules:"none",variables:"none",messages:"none",events:"none",devices:"none",groups:"none",plugins:"none",updates:"none"}]}),this.setupStorage(),this.updateProcessStatus.subscribe(function(t){switch(t){case"running":return pimatic.loading("update-process-status","show",{text:__("Installing updates, Please be patient")});default:return pimatic.loading("update-process-status","hide")}}),this.autosave=ko.computed(function(t){return function(){var e;if(t._dataLoaded())return e=t.toJS(),pimatic.storage.set("pimatic.scope",e)}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),this.rememberme.subscribe(function(t){var e;return e=pimatic.storage.get("pimatic"),pimatic.storage.removeAll(),pimatic.storage=t?$.localStorage:$.sessionStorage,e.scope.rememberMe=t,pimatic.storage.set("pimatic",e)}),this.getUngroupedDevices=ko.pureComputed(function(t){return function(){var e,r,i,n,o;for(o=[],r=0,i=(n=t.devices()).length;r<i;r++)null==(e=n[r]).group()&&o.push(e);return o}}(this))}return e.mapping={$default:"ignore",devices:{$key:"id",$itemOptions:{$handler:"callback",$create:function(e){return new t(e)},$update:function(t,e){return e.update(t),e}}},rules:{$key:"id",$itemOptions:{$handler:"callback",$create:function(t){return new o(t)},$update:function(t,e){return e.update(t),e}}},variables:{$key:"name",$itemOptions:{$handler:"callback",$create:function(t){return new u(t)},$update:function(t,e){return e.update(t),e}}},devicepages:{$key:"id",$itemOptions:{$handler:"callback",$create:function(t){return new r(t)},$update:function(t,e){return e.update(t),e}}},groups:{$key:"id",$itemOptions:{$handler:"callback",$create:function(t){return new i(t)},$update:function(t,e){return e.update(t),e}}},errorCount:"observe",rememberme:"observe",updateProcessStatus:"observe",updateProcessMessages:"array",guiSettings:"observe",username:"observe",role:"observe",permissions:"observe"},e.prototype.socket=null,e.prototype.inited=!1,e.prototype.pages={},e.prototype.storage=null,e.prototype._dataLoaded=ko.observable(!1),e.prototype.nullDevice=new t({id:"null",name:"null",attributes:[],actions:[],template:"null"}),e.prototype.loadDataFromStorage=function(){var t,e;if(this._dataLoaded(!0),pimatic.storage.isSet("pimatic.scope")){t=pimatic.storage.get("pimatic.scope");try{return this.updateFromJs(t)}catch(t){return e=t,TraceKit.report(e),pimatic.storage.removeAll(),window.location.reload()}}},e.prototype.updateFromJs=function(t){return ko.mapper.fromJS(t,e.mapping,this)},e.prototype.toJS=function(){return ko.mapper.toJS(this,e.mapping)},e.prototype.setupStorage=function(){return $.localStorage.isSet("pimatic")?(pimatic.storage=$.localStorage,$.sessionStorage.removeAll(),this.rememberme(!0)):$.sessionStorage.isSet("pimatic")?(pimatic.storage=$.sessionStorage,$.localStorage.removeAll(),this.rememberme(!1)):(pimatic.storage=$.sessionStorage,this.rememberme(!1),pimatic.storage.set("pimatic",{}))},e.prototype.getDeviceById=function(t){return ko.utils.arrayFirst(this.devices(),function(e){return e.id===t})},e.prototype.getGroupOfDevice=function(t){var e,r,i,n;for(r=0,i=(n=this.groups()).length;r<i;r++)if(e=n[r],-1!==ko.utils.arrayIndexOf(e.devices(),t))return e;return null},e.prototype.updateDeviceAttribute=function(t,e,r,i){var n,o,u,a,s;for(s=[],o=0,u=(a=this.devices()).length;o<u;o++){if((n=a[o]).id===t){n.updateAttribute(e,r,i);break}s.push(void 0)}return s},e.prototype.updateDeviceFromJs=function(t){var r;return null==(r=this.getDeviceById(t.id))?(r=e.mapping.devices.$itemOptions.$create(t),this.devices.push(r)):r.update(t)},e.prototype.updateDeviceOrder=function(t){var e;return e=function(e){var r;return-1===(r=$.inArray(e,t))?999999:r},this.devices.sort(function(t,r){return e(t.id)-e(r.id)})},e.prototype.removeDevice=function(t){return this.devices.remove(function(e){return e.id===t})},e.prototype.getPageById=function(t){return ko.utils.arrayFirst(this.devicepages(),function(e){return e.id===t})},e.prototype.removePage=function(t){return this.devicepages.remove(function(e){return e.id===t})},e.prototype.updatePageFromJs=function(t){var r;return null==(r=this.getPageById(t.id))?(r=e.mapping.devicepages.$itemOptions.$create(t),this.devicepages.push(r)):r.update(t)},e.prototype.updatePageOrder=function(t){var e;return e=function(e){var r;return-1===(r=$.inArray(e,t))?999999:r},this.devicepages.sort(function(t,r){return e(t.id)-e(r.id)})},e.prototype.getGroupById=function(t){return ko.utils.arrayFirst(this.groups(),function(e){return e.id===t})},e.prototype.removeGroup=function(t){return this.groups.remove(function(e){return e.id===t})},e.prototype.updateGroupFromJs=function(t){var r;return null==(r=this.getGroupById(t.id))?(r=e.mapping.groups.$itemOptions.$create(t),this.groups.push(r)):r.update(t)},e.prototype.getGroupOfRule=function(t){var e,r,i,n;for(r=0,i=(n=this.groups()).length;r<i;r++)if(e=n[r],-1!==ko.utils.arrayIndexOf(e.rules(),t))return e;return null},e.prototype.updateGroupOrder=function(t){var e;return e=function(e){var r;return-1===(r=$.inArray(e,t))?999999:r},this.groups.sort(function(t,r){return e(t.id)-e(r.id)})},e.prototype.getRuleById=function(t){return ko.utils.arrayFirst(this.rules(),function(e){return e.id===t})},e.prototype.removeRule=function(t){return this.rules.remove(function(e){return e.id===t})},e.prototype.updateRuleFromJs=function(t){var r;return null==(r=this.getRuleById(t.id))?(r=e.mapping.rules.$itemOptions.$create(t),this.rules.push(r)):r.update(t)},e.prototype.updateRuleOrder=function(t){var e;return e=function(e){var r;return-1===(r=$.inArray(e,t))?999999:r},this.rules.sort(function(t,r){return e(t.id)-e(r.id)})},e.prototype.removeVariable=function(t){return this.variables.remove(function(e){return e.name===t})},e.prototype.getVariableByName=function(t){return ko.utils.arrayFirst(this.variables(),function(e){return e.name===t})},e.prototype.updateVariableValue=function(t,e){var r;if(null!=(r=this.getVariableByName(t)))return r.value(e)},e.prototype.updateVariableFromJs=function(t){var r;return null==(r=this.getVariableByName(t.name))?(r=e.mapping.variables.$itemOptions.$create(t),this.variables.push(r)):r.update(t)},e.prototype.updateVariableOrder=function(t){var e;return e=function(e){var r;return-1===(r=$.inArray(e,t))?999999:r},this.variables.sort(function(t,r){return e(t.name)-e(r.name)})},e.prototype.getGroupOfVariable=function(t){var e,r,i,n;for(r=0,i=(n=this.groups()).length;r<i;r++)if(e=n[r],-1!==ko.utils.arrayIndexOf(e.variables(),t))return e;return null},e.prototype.hasPermission=function(t,e){var r;switch(r=this.permissions()[t],e){case"read":return"read"===r||"write"===r;case"write":return"write"===r;default:return!1}},e.prototype.isDemo=function(){var t;return null!=(t=this.guiSettings())?t.demo:void 0},e}(),window.pimatic=new n,window.pimatic.Device=t,window.pimatic.Rule=o,window.pimatic.Group=i,window.pimatic.Variable=u,window.pimatic.DevicePage=r,$(document).on("templateready",function(t){pimatic._dataLoaded()||pimatic.loadDataFromStorage()})}).call(this);;
(function(){var e=[].slice;!function(){var e,t;if(jQuery.mobile.loader.prototype.fakeFixLoader=function(){},t={},e=function(){var e,n,a,i;a={text:"",textVisible:!0,textonly:!1},e=!1;for(n in t)null!=(i=t[n]).text&&(0!==a.text.length&&(a.text+=", "),a.text+=i.text),!0===i.blocking&&(e=!0);return 0!==a.text.length?a.text+="...":a.textVisible=!1,e?$("body").addClass("ui-loading-blocking"):($("body").removeClass("ui-loading-blocking"),a.textVisible=!0,a.textonly=!0,0===a.text.length&&(a.text=__("Loading")+"...")),a},pimatic.loading=function(n,a,i){setTimeout(function(){var o;switch(a){case"show":return t[n]=i,$.mobile.loading("show",e());case"hide":return delete t[n],0===function(){var e;e=[];for(o in t)e.push(o);return e}().length?($.mobile.loading("hide"),$("body").removeClass("ui-loading-blocking")):$.mobile.loading("show",e())}},1)},pimatic.loading.pendingLoadings=t,$(document).on("pagechange",function(n){setTimeout(function(){var n,a;if(0!==function(){var e;e=[];for(n in t)e.push(n);return e}().length)return a=e(),$.mobile.loading("show",a)},1)}),$(document).on("vclick",".ui-loader",function(){return window.location.reload()}),"none"!==overthrow.support)$.mobile.Transition.prototype.scrollPage=function(){}}(),$.ajaxSetup({timeout:2e4}),$(document).ajaxStart(function(){return pimatic.loading("ajax","show",{text:"loading",blocking:!0})}),$(document).ajaxStop(function(){return pimatic.loading("ajax","hide")}),$(document).ajaxError(function(){}),$(document).ready(function(){if(window.applicationCache)return window.applicationCache.addEventListener("updateready",function(e){return window.applicationCache.status!==window.applicationCache.UPDATEREADY||pimatic.themeChanged||(window.applicationCache.swapCache(),swal({title:"Reload?",text:"A new version of the frontend is available. Load it?",type:"info",showCancelButton:!0,cancelButtonText:"Not right now...",confirmButtonText:"Reload!",closeOnConfirm:!1},function(){return swal("Reloading!","Reloading app, please wait.","success"),window.location.reload()})),pimatic.themeChanged=!1},!1)},!1),pimatic.try=function(e){try{return e.apply(this,arguments)}catch(e){e}},pimatic.tryCatch=function(e){return function(){var t;try{return e.apply(this,arguments)}catch(e){return t=e,TraceKit.report(t)}}},window.ajaxShowToast=function(e,t,n){return pimatic.showToast(null!=e.message?__(e.message):__("done"))},window.ajaxAlertFail=function(e,t,n){var a,i;a=null;try{a=$.parseJSON(e.responseText)}catch(e){e}return i=null!=(null!=a?a.message:void 0)?a.message:i=null!=n&&""!==n?n:"error"===t?__("No connection"):t,swal("Oops...",__(i),"error"),!0},pimatic.timestampToDateTime=function(e){var t,n,a;return a=function(e){return e<10?"0"+e:""+e},t=new Date(e),n=t.getFullYear()+"-"+a(t.getMonth()+1)+"-"+a(t.getDate()),e=a(t.getHours())+":"+a(t.getMinutes())+":"+a(t.getSeconds()),{date:n,time:e}},pimatic.toHHMMSS=function(e){var t,n,a;return a=parseInt(e,10),t=Math.floor(a/3600),n=Math.floor((a-3600*t)/60),e=a-3600*t-60*n,t<10&&(t="0"+t),n<10&&(n="0"+n),e<10&&(e="0"+e),t+":"+n+":"+e},$(document).ready(function(){var e;e=ko.observableArray([]),ko.applyBindings({toastMessages:e},$("#toasts")[0]),pimatic.showToast=function(t){var n;n={message:t},e.push(n),setTimeout(function(){return e.remove(n)},4500)}}),pimatic.isValidId=function(e){return null!=e.match(/^[a-z0-9_-]+$/)},pimatic.isValidVariableName=function(e){return null!=e.match(/^[a-zA-Z0-9_-]+$/)},pimatic.invalidIdMessage='The entered ID is not valid. Please use only lowercase alphanumeric characters, "_" and "-".',pimatic.invalidVariableNameMessage='The entered variable name is not valid. Please use only alphanumeric characters, "_" and "-".',pimatic.makeIdFromName=function(e){var t,n,a,i;for(e=(e=e.replace(/^\s+|\s+$/g,"")).toLowerCase(),i="aaaaeeeeiiiioooouuuunc------",n=0,a=(t="àáäâèéëêìíïîòóöôùúüûñç·/_,:;").length;n<a;)e=e.replace(new RegExp(t.charAt(n),"g"),i.charAt(n)),n++;return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")},pimatic.autoFillId=function(e,t,n){var a;a="",e.subscribe(function(e){var i,o;{if("add"===n())return i=t(),o=pimatic.makeIdFromName(e),i!==a&&0!==i.length||t(o),a=o;a=""}})},window.__=function(){var t,n,a,i,o,r;for(o=arguments[0],n=2<=arguments.length?e.call(arguments,1):[],r=o,null!=locale[o]&&(r=locale[o]),a=0,i=n.length;a<i;a++)t=n[a],r=r.replace(/%s/,t);return r},null==window.console&&(window.console={log:function(){}}),TraceKit.report.subscribe(function(e){var t,n,a,i,o,r,c,l,s;for(i=0,o=(l=e.stack).length;i<o;i++)if(null!=(n=l[i]).context)for(a=c=0,r=(s=n.context).length;c<r;a=++c)(t=s[a]).length>200&&(n.context[a]=t.substring(0,200)+"...");return $.ajax({url:"/client-error",type:"POST",global:!1,data:{error:e}})}),pimatic.changeTheme=function(e){return $("#theme-link").attr("href","/theme/"+e+".css?save=1"),$("#select-theme").val(e),pimatic.themeChanged=!0,pimatic.storage.set("pimatic.theme",e)},function(){var e,t,n,a,i;(a=$("#theme-link")).remove(),null!=(n=pimatic.storage.get("pimatic.theme"))?a.attr("href","/theme/"+n+".css?save=1"):(e=a.attr("data-default-theme"),a.attr("href","/theme/"+e+".css?save=1")),pimatic.themeChanged=!0,t=a.prop("outerHTML"),document.write(t),$(document).on("change","#select-theme",function(){return pimatic.changeTheme($(this).val())}),(i=function(){var e,t;if(e=$("#index .ui-header").css("background-color"),t=$("#theme-color"),null!=e&&e!==t.attr("content"))return t.attr("content",e)})(),setInterval(i,500)}(),pimatic.fixedAddElement=function(e,t,n,a){var i,o;return i=function(){if(e())return n.css({width:a.width()})},$(window).resize(i),o=t(),t.subscribe(function(e){return(o=e)?(a.css({height:a.height()+n.outerHeight()}),a.parent().css({"padding-bottom":0})):a.parent().css({"padding-bottom":n.outerHeight()})}),ko.computed(function(){return e()&&!o?(n.css({position:"fixed",left:0,bottom:0,height:n.height(),width:a.width(),"z-index":3}),a.parent().css({"padding-bottom":n.outerHeight()}),n.addClass("fixed-add-element")):(n.css({position:"relative",height:"auto",width:"auto"}),a.parent().css({"padding-bottom":0}),n.removeClass("fixed-add-element"))}).extend({rateLimit:{timeout:200,method:"notifyWhenChangesStop"}})},$.mobile.changePage=function(e,t){var n;return"index"!==(n="string"==typeof e?e.split("#")[1]:e.attr("id"))&&null!=scripts[n]?LazyLoad.js(scripts[n],function(){return $.mobile.pageContainer.pagecontainer("change",e,t)}):$.mobile.pageContainer.pagecontainer("change",e,t)}}).call(this);;
(function(){var t=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1};!function(){var e,n;n=function(t,e){var n,i;return(i=function(){var e,i,o,l;for(l=[],e=0,i=(o=t.attr("class").split(" ")).length;e<i;e++)0!==(n=o[e]).lastIndexOf("ui-icon-")&&l.push(n);return l}()).push("ui-icon-"+e),t.attr("class",i.join(" "))},ko.bindingHandlers.jqmbutton={init:function(t,e,n){var i;i=e(),ko.unwrap(i),$(t)},update:function(t,e,i){var o,l,a,r,s;if(r=e(),s=ko.unwrap(r),o=$(t),null!=s.text&&(a=ko.unwrap(s.text),o.text(a)),null!=s.icon&&(l=ko.unwrap(s.icon),n(o,l)),null!=s.enabled)if(ko.unwrap(s.enabled))try{o.button("enable")}catch(t){t,o.removeClass("ui-state-disabled")}else try{o.button("disable")}catch(t){t,o.addClass("ui-state-disabled")}}},ko.bindingHandlers.jqmlistitem={update:function(t,e,i){var o,l,a;if(a=e(),ko.unwrap(a),o=$(t),null!=a.icon)return l=ko.unwrap(a.icon),n(o,l)}},ko.bindingHandlers.jqmenabled={update:function(t,e,n){var i,o,l;switch(o=e(),l=ko.unwrap(o),i=$(t),t.type){case"select-one":null!=i.data("mobileFlipswitch")?l?i.flipswitch("enable"):i.flipswitch("disable"):l?i.selectmenu("enable"):i.selectmenu("disable");break;default:l?i.textinput("enable"):i.textinput("disable")}}},ko.bindingHandlers.jqmchecked={init:function(t,e,n){ko.bindingHandlers.checked.init(t,e,n),$(t).checkboxradio()},update:function(t,e){var n;n=e(),ko.unwrap(n),$(t).checkboxradio("refresh")}},ko.bindingHandlers.jqmselectedOptions={init:function(t,e){var n,i;return i=e(),(n=$(t)).on("change",function(){var t;return null==(t=n.val())&&(t=[]),i(t)})},update:function(t,e){var n,i;i=e(),(n=$(t)).val(i()),n.selectmenu("refresh",!0)}},ko.bindingHandlers.jqmflipswitch={init:function(t,e){var n,i;if(i=e(),(n=$(t)).flipswitch(),ko.isObservable(i))return n.on("change",function(){var t;switch(t=n.val()){case"true":t=!0;break;case"false":t=!1}if(ko.unwrap(i)!==t)return i(t)})},update:function(t,e){var n,i,o;i=e(),o=ko.unwrap(i),n=$(t),"boolean"==typeof o&&(o=""+o),n.val(o),n.flipswitch("refresh")}},ko.bindingHandlers.jqmoptions={init:function(t,e,n){ko.bindingHandlers.options.init(t,e,n),$(t).selectmenu()},update:function(t,e,n){var i,o;ko.bindingHandlers.options.update(t,e,n),null!=(o=null!=(i=n())?i.value():void 0)&&$(t).val(o),$(t).selectmenu("refresh")}},ko.bindingHandlers.jqmlistview={init:function(t,e,n){setTimeout(function(){return $(t).listview()},1)},update:function(t,e,n){e(),setTimeout(function(){try{return $(t).listview("refresh")}catch(t){t}},1)}},ko.bindingHandlers.jqmtextinput={init:function(t,e,n){$(t).textinput({enhanced:!0}),ko.bindingHandlers.textInput.init(t,e,n)}},ko.bindingHandlers.sparkline={init:function(t,e){return ko.bindingHandlers.sparkline.update(t,e),setTimeout(function(){return $.sparkline_display_visible()},100)},update:function(t,e){var n,i,o,l;return o=e(),l=ko.unwrap(o),n=ko.unwrap(l.data),i=l.tooltipFormatter,$(t).sparkline(n,{disableTooltips:!0,height:19,type:"line",lineColor:"#7c7c7c",fillColor:"#cccccc",spotColor:"#666666",minSpotColor:null,maxSpotColor:null,highlightSpotColor:null,highlightLineColor:null,drawNormalOnTop:!1,tooltipFormatter:i})}},ko.bindingHandlers.toast={init:function(t,e){var n,i,o,l;return o=e(),l=ko.unwrap(o),(n=$(t)).text(l),n.toast(),n.toast("show"),i=n.outerHeight()+2,n.parent().find(".ui-toast").each(function(){var e,n;this!==t&&((e=$(this)).addClass("animated-toast"),n=e.data("top")+i,e.css("top",n+"px"),e.data("top",n))})}},ko.bindingHandlers.tooltip={init_tooltip:function(t,e,n){var i,o,l,a;return i=Math.min(n.parent().height(),$(window).height()),(o=Math.min(n.parent().width(),$(window).width()))<1.5*e.outerWidth()?e.css("max-width",o/2):e.css("max-width",340),l=t.offset().left+t.outerWidth()/2-e.outerWidth()/2,a=t.offset().top-e.outerHeight()-20,l<0?(l=t.offset().left+t.outerWidth()/2-20,e.addClass("left")):e.removeClass("left"),l+e.outerWidth()>o?(l=t.offset().left-e.outerWidth()+t.outerWidth()/2+20,e.addClass("right")):e.removeClass("right"),a+e.outerHeight()+30>i?(a-=10,e.removeClass("top")):(a=t.offset().top+t.outerHeight()-10,e.addClass("top")),e.removeClass("animated-tooltip").css({left:l,top:a,opacity:0}),e[0].offsetWidth=e[0].offsetWidth,e.addClass("animated-tooltip").css({top:a+20}).animate({opacity:1},100),e},remove_tooltip:function(t,e){return ko.bindingHandlers.tooltip.doRemove=!0,e.animate({opacity:0},200,function(){if(ko.bindingHandlers.tooltip.doRemove)return e.removeClass("animated-tooltip").remove()})},init:function(e,n){var i,o;return i=$(e),o=n(),i.bind("vclick",function(){var e,l,a,r,s,u;if(!(s=ko.unwrap(o))||""===s)return!1;0===(u=$("#tooltip")).length&&(u=$('<div id="tooltip" class="ui-corner-all"></div>')).css("opacity",0).html(s).appendTo("body"),ko.bindingHandlers.tooltip.doRemove=!1,null!=(a=ko.bindingHandlers.tooltip.subscribtion)&&a.dispose(),clearInterval(ko.bindingHandlers.tooltip.interval),clearTimeout(ko.bindingHandlers.tooltip.timeout),$(window).off("touchstart",ko.bindingHandlers.tooltip.touchdispose),0===(e=i.parents(".owl-item")).length&&(e=i.parents(".ui-content.overthrow")),ko.bindingHandlers.tooltip.init_tooltip(i,u,e),ko.bindingHandlers.tooltip.subscribtion=ko.computed(function(){return s=n()(),u.html(s),ko.bindingHandlers.tooltip.init_tooltip(i,u,e)}),r=function(t){var n;return clearInterval(ko.bindingHandlers.tooltip.interval),clearTimeout(ko.bindingHandlers.tooltip.timeout),ko.bindingHandlers.tooltip.subscribtion.dispose(),$(window).off("touchstart",ko.bindingHandlers.tooltip.touchdispose),e.off("scroll",r),u.off("vclick",r),void 0!==l&&null!==l&&i.off("mouseleave",l),null!=t&&0!==$(t.target).parents("#tooltip").length&&((""===(n=$(t.target).attr("href"))||n.match(/^#.*/))&&t.preventDefault(),t.stopImmediatePropagation(),$(t.target).click()),ko.bindingHandlers.tooltip.remove_tooltip(i,u),!0},t.call(window,"ontouchstart")>=0||i.one("mouseleave",l=function(t){return clearInterval(ko.bindingHandlers.tooltip.interval),ko.bindingHandlers.tooltip.interval=setInterval(function(){if(0===$("#tooltip:hover").length)return r()},1e3)}),clearTimeout(ko.bindingHandlers.tooltip.timeout),ko.bindingHandlers.tooltip.touchdispose=r,ko.bindingHandlers.tooltip.timeout=setTimeout(function(){return u.one("vclick",r),$(window).one("touchstart",ko.bindingHandlers.tooltip.touchdispose)},310),e.one("scroll",r)})}},e=function(t){return this.element=t,this.$element=$(t),this.scrollMargin=Math.floor(this.$element.innerHeight()/10),this.offset=this.$element.offset(),this.innerHeight=this.$element.innerHeight(),this.scrollDeltaMin=5,this.scrollDeltaMax=30},e.prototype.scroll=function(t,e){var n,i,o,l;return l=this.scrollMargin+this.offset.top,void 0,i=0,e<l&&(i=-((l-e)/this.scrollMargin*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin)),n=this.offset.top+this.innerHeight-this.scrollMargin,e>n&&(i=(e-n)/this.scrollMargin*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin),0!==i&&(o=this.$element.scrollTop(),this.$element.scrollTop(o+i),i=this.$element.scrollTop()-o),i},ko.bindingHandlers.sortable={init:function(t,n,i,o,l){var a,r,s;return s=n(),r=s.items,a=function(e){var n,i,o,l,a;return l=null,i=null,a=null,o=null,n=e.offset(),$(t).find(".sortable").each(function(t,r){var s,u,d;if(r!==e[0])if((s=$(r).offset()).top<n.top){if(null==a||s.top>a.top)return u=[r,s],l=u[0],a=u[1],u}else if(s.top>n.top&&(null==o||s.top<o.top))return d=[r,s],i=d[0],o=d[1],d}),{eleBefore:l,eleAfter:i}},$(t).on("MSPointerDown touchstart mousedown",".handle",function(n){var i,l,u,d,c,p,f,h;return l=$(this).parents(".sortable"),p=function(){var e,n,i,o,r,s,u,d,c;if(u=l.offset(),r=l.outerHeight(),u.bottom=u.top+r,d=a(l),i=d.eleBefore,e=d.eleAfter,(c=$(t).find(".sortable")).each(function(t,e){if(e!==l[0])return $(e).css("margin-bottom",0),$(e).css("margin-top",0)}),c.length>1?null!=i?((o=$(i).offset()).width=$(i).outerHeight(),o.middle=o.top+o.width/2,o.bottom=o.top+o.width,u.top<o.middle?$(i).css("margin-top",r):null!=e?((n=$(e).offset()).width=$(e).outerHeight(),n.middle=n.top+n.width/2,u.bottom>n.middle&&u.top>o.bottom+r/2?$(e).css("margin-bottom",r):$(i).css("margin-bottom",r)):$(i).css("margin-bottom",r)):null!=e&&$(e).css("margin-top",r):l.css("margin-bottom",""),0!==(s=u.top-l.offset().top))return l.data("plugin_pep").doMoveTo(0,s)},c=function(){var t,e,n,i,u,d,c,p,f,h,g;if(p=a(l),i=p.eleBefore,n=p.eleAfter,null!==i||null!==n)if(u=ko.dataFor(l[0]),e=null!=i?ko.dataFor(i):void 0,t=null!=n?ko.dataFor(n):void 0,null!=r){if(f=r.indexOf(u),h=null!=i?(d=r.indexOf(e)+1,f<d&&d--,d):0,f>=0&&h>=0&&f!==h&&(g=ko.utils.unwrapObservable(r),c=g[f],r.valueWillMutate(),g.splice(f,1),g.splice(h,0,c),r.valueHasMutated(),null!=s.sorted))return s.sorted.call(o,u,e,t)}else if(null!=s.sorted)return s.sorted.call(o,u,e,t)},f=null,h=null,u=null,d=null,i=null,l.pep({place:!1,axis:"y",shouldEase:!1,constrainTo:"parent",droppable:s.droppable||".droppable",overlapFunction:function(t,e){var n,i;return n=t[0].getBoundingClientRect(),i=e[0].getBoundingClientRect(),i.bottom-n.bottom>-20&&i.bottom-n.bottom<10},start:function(){var n;return $(t).css("height",$(t).height()),clearTimeout(i),null!=s.isSorting&&s.isSorting(!0),$(t).addClass("noAnimation"),l.css("margin-bottom",-l.innerHeight()),n=$(t).parents(s.scroller||".ui-content.overthrow"),u=new e(n[0]),null,null,d=setInterval(function(){var t;if(0!==(t=u.scroll(f,h)))return l.data("plugin_pep").doMoveTo(0,t)},100)},stop:function(e,n){var a;return clearTimeout(d),a=n.activeDropRegions.length>0,$(n.activeDropRegions).each(function(t,e){if(null!=s.drop)return s.drop.call(o,ko.dataFor(l[0]),e)}),a||c(),l.data("plugin_pep"),$.pep.unbind(l),$(t).find(".sortable").attr("style",""),$(t).css("height",""),null!=s.isSorting&&s.isSorting(!1),i=setTimeout(function(){return $(t).removeClass("noAnimation")},100),l.removeClass("ui-btn-active")},drag:function(t,e){return f=t.pageX,h=t.pageY,p(),!0}}),l.data("plugin_pep").handleStart(n),n.stopImmediatePropagation()})}},ko.bindingHandlers.jqmselectvalue={init:function(t,e,n,i){var o;return void 0!==ko.bindingHandlers.value.init&&ko.bindingHandlers.value.init(t,e,n,i),o=e(),ko.unwrap(o)},update:function(t,e,n,i){var o;return void 0!==ko.bindingHandlers.value.update&&ko.bindingHandlers.value.update(t,e,n,i),$(t).selectmenu("refresh",!0),o=e(),ko.unwrap(o)}},ko.bindingHandlers.dragslide={init:function(t,e,n,i,o){var l,a,r,s,u;u=e(),ko.toJS(u).options,$(t).css({overflow:"hidden"}),$(t).on("selectstart mousedown",function(t){return t.preventDefault()}),s=function(t,e){return $(".drag-message").text(e).css({top:t.position().top,height:t.outerHeight(),"line-height":t.outerHeight()+"px"}).fadeIn(500)},a=null,l=!1,$(t).on("click",function(t){return l?t.preventDefault():a=null}),r=null,$(t).on("vmousedown",".draggable",function(t){if(null!=(r=$(t.target).parents(".draggable"))?r.length:void 0)return a=t}),$(t).on("vmousemove",".draggable",function(t){var e,n,i,o,u,d;return d=$(t.target).parents(".draggable"),null!=a&&(null!=d?d.length:void 0)&&(null!=r?r.length:void 0)&&r[0]===d[0]?(n=Math.abs(t.pageX-a.pageX),i=Math.abs(t.pageY-a.pageY),n>i&&n>5?(t.preventDefault(),t.stopPropagation(),a.preventDefault(),o=ko.dataFor(d[0]),e=null,u=d.position(),d.pep({place:!1,axis:"x",shouldEase:!0,revert:!0,shouldPreventDefault:!1,start:function(t,e){return l=!0},rest:function(t,e){return d.data("plugin_pep"),$.pep.unbind(d),d.attr("style",""),l=!1},drag:function(t,n){var i;return(i=d.position().left-u.left)<-120?"deactivate"!==e&&(s(d,__("deactivate rule")).addClass("deactivate").removeClass("activate"),e="deactivate"):i>120?"activate"!==e&&(s(d,__("activate rule")).addClass("activate").removeClass("deactivate"),e="activate"):null!=e&&($(".drag-message").fadeOut(500),e=null),!0},stop:function(t,n){var i;return $(".drag-message").text("").fadeOut().removeClass("activate").removeClass("deactivate"),null!=e&&(i="activate"===e,pimatic.loading("saveactivate","show",{text:__(e)}),pimatic.client.rest.updateRuleByString({ruleId:o.id,rule:{active:i}}).always(function(){return pimatic.loading("saveactivate","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)),d.removeClass("ui-btn-active")}}),d.data("plugin_pep").revert=function(){return this.shouldUseCSSTranslation()&&this.moveToUsingTransforms(-this.xTranslation(),0),this.moveTo(this.initialPosition.left,0)},d.data("plugin_pep").handleStart(a),a=null):void 0):(r=null,void(a=null))})}}}()}).call(this);;
(function(){var e;e=pimatic.tryCatch,$(document).on("pagebeforecreate",function(t){var i;if(null==pimatic.socket)return pimatic.socket=io(document.location.host+"/",{reconnection:!0,reconnectionDelay:1e3,reconnectionDelayMax:3e3,timeout:2e4,forceNew:!0}),pimatic.socket.io.on("open",function(){var e;if(pimatic.loading("socket","hide"),null!=window.applicationCache)try{return window.applicationCache.update()}catch(t){return e=t,console.log(e)}}),i=0,pimatic.socket.on("connect",function(){var e;return pimatic.loading("socket","hide"),null!=(e=pimatic.pages.login)&&e.hideLoginDialog(),i=0,pimatic.socket.emit("call",{id:"errorMessageCount",action:"queryMessagesCount",params:{criteria:{level:"error"}}}),pimatic.socket.emit("call",{id:"guiSettings",action:"getGuiSettings",params:{}}),pimatic.socket.emit("call",{id:"updateProcessStatus",action:"getUpdateProcessStatus",params:{}})}),pimatic.socket.on("callResult",function(e){var t,i,n,o,c;switch(e.id){case"errorMessageCount":if(e.success)return pimatic.errorCount(e.result.count);break;case"guiSettings":if(e.success){o=(t=e.result.guiSettings).defaults;for(n in o)c=o[n],null==t.config[n]&&(t.config[n]=c);return pimatic.guiSettings(t.config)}break;case"updateProcessStatus":return i=e.result.info,pimatic.updateProcessStatus(i.status),pimatic.updateProcessMessages(i.messages)}}),pimatic.socket.on("hello",e(function(e){return pimatic.username(e.username),pimatic.role(e.role),pimatic.permissions(e.permissions)})),pimatic.socket.on("devices",e(function(e){return pimatic.updateFromJs({devices:e})})),pimatic.socket.on("rules",e(function(e){return pimatic.updateFromJs({rules:e})})),pimatic.socket.on("variables",e(function(e){return pimatic.updateFromJs({variables:e})})),pimatic.socket.on("pages",e(function(e){return pimatic.updateFromJs({devicepages:e})})),pimatic.socket.on("groups",e(function(e){return pimatic.updateFromJs({groups:e})})),pimatic.socket.on("deviceAttributeChanged",function(e){return pimatic.updateDeviceAttribute(e.deviceId,e.attributeName,e.time,e.value)}),pimatic.socket.on("deviceOrderChanged",e(function(e){return pimatic.updateDeviceOrder(e)})),pimatic.socket.on("deviceChanged",e(function(e){return pimatic.updateDeviceFromJs(e)})),pimatic.socket.on("deviceRemoved",e(function(e){return pimatic.removeDevice(e.id)})),pimatic.socket.on("deviceAdded",e(function(e){return pimatic.updateDeviceFromJs(e)})),pimatic.socket.on("pageChanged",e(function(e){return pimatic.updatePageFromJs(e)})),pimatic.socket.on("pageRemoved",e(function(e){return pimatic.removePage(e.id)})),pimatic.socket.on("pageAdded",e(function(e){return pimatic.updatePageFromJs(e)})),pimatic.socket.on("pageOrderChanged",e(function(e){return pimatic.updatePageOrder(e)})),pimatic.socket.on("groupChanged",e(function(e){return pimatic.updateGroupFromJs(e)})),pimatic.socket.on("groupRemoved",e(function(e){return pimatic.removeGroup(e.id)})),pimatic.socket.on("groupAdded",e(function(e){return pimatic.updateGroupFromJs(e)})),pimatic.socket.on("groupOrderChanged",e(function(e){return pimatic.updateGroupOrder(e)})),pimatic.socket.on("ruleAdded",e(function(e){return pimatic.updateRuleFromJs(e)})),pimatic.socket.on("ruleChanged",e(function(e){return pimatic.updateRuleFromJs(e)})),pimatic.socket.on("ruleRemoved",e(function(e){return pimatic.removeRule(e.id)})),pimatic.socket.on("ruleOrderChanged",e(function(e){return pimatic.updateRuleOrder(e)})),pimatic.socket.on("variableAdded",e(function(e){return pimatic.updateVariableFromJs(e)})),pimatic.socket.on("variableChanged",e(function(e){return pimatic.updateVariableFromJs(e)})),pimatic.socket.on("variableValueChanged",e(function(e){return pimatic.updateVariableValue(e.variableName,e.variableValue)})),pimatic.socket.on("variableRemoved",e(function(e){return pimatic.removeVariable(e.name)})),pimatic.socket.on("variableOrderChanged",e(function(e){return pimatic.updateVariableOrder(e)})),pimatic.socket.on("updateProcessStatus",e(function(e){return pimatic.updateProcessStatus(e.status)})),pimatic.socket.on("updateProcessMessage",e(function(e){return pimatic.updateProcessMessages.push(e.message)})),pimatic.socket.on("messageLogged",e(function(e){if("debug"!==e.level&&pimatic.try(function(){return pimatic.showToast(e.msg)}),"error"===e.level)return pimatic.errorCount(pimatic.errorCount()+1)})),pimatic.loading("socket","show",{text:__("Connecting"),blocking:!1}),pimatic.socket.io.on("reconnect_attempt",function(){return pimatic.loading("socket","show",{text:__("Reconnecting"),blocking:!1})}),pimatic.socket.io.on("connect_error",function(e){return pimatic.loading("socket","show",{text:__("Could not connect (%s), retrying",e.message),blocking:!1})}),pimatic.socket.io.on("connect_timeout",function(){return pimatic.loading("socket","show",{text:__("Connect timed out"),blocking:!1})}),pimatic.socket.io.on("close",function(){if(!0===pimatic.socket.io.reconnection())return pimatic.socket.io.reconnect()}),pimatic.socket.on("error",function(e){var t;return i++,"Authentication error"===e&&null!=(null!=(t=pimatic.pages)?t.login:void 0)?(pimatic.socket.io.reconnection(!1),pimatic.socket.io.disconnect(),pimatic.pages.login.showLoginDialog()):(pimatic.socket.io.disconnect(),pimatic.loading("socket","show",{text:__("Connection lost: %s",e),blocking:!1}))}),function(){var e,t,i,n;if(t=null,n=null,i=null,e=function(){document[t]?(clearTimeout(i),i=setTimeout(function(){return pimatic.socket.io.reconnection(!1),pimatic.socket.io.disconnect()},1e4)):(clearTimeout(i),pimatic.socket.io.reconnection(!0),pimatic.socket.connected||(pimatic.loading("socket","show",{text:__("Reconnecting"),blocking:!1}),pimatic.socket.io.connect()))},null!=document.hidden?(t="hidden",n="visibilitychange"):null!=document.mozHidden?(t="mozHidden",n="mozvisibilitychange"):null!=document.msHidden?(t="msHidden",n="msvisibilitychange"):null!=document.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),null!=document.addEventListener&&null!=document[t])return document.addEventListener(n,e,!1)}()})}).call(this);;
(function(){var t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}};$(document).on("pagebeforecreate",function(e){var n,r,s,o,a,u,c,l,p,h,d,m,f,v,g,b;null==pimatic.templateClasses&&(b=$("#sortable-handle-template").text(),l=function(){function t(t){this.templData=t,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)}return t.prototype.update=function(t){return this.templData=t,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)},t.prototype.afterRender=function(t){return $(t).addClass("item").find("label").before($(b))},t}(),a=function(e){function i(t){var e,i,n,r;if(0===t.length)this.title="Ungrouped";else for(this.title="",i=n=0,r=t.length;n<r;i=++n)e=t[i],0!==i&&(this.title+=", "),this.title+=e.name()}return t(i,l),i.prototype.afterRender=function(){},i.prototype.getItemTemplate=function(){return"header"},i}(),s=function(e){function n(t,e){this.device=e,this.labelTooltipHtml=i(this.labelTooltipHtml,this),n.__super__.constructor.call(this,t),this.name=this.device.name,this.deviceId=t.deviceId}return t(n,l),n.mapping={$default:"ignore",deviceId:"copy"},n.prototype.getAttribute=function(t){return this.device.getAttribute(t)},n.prototype.getItemTemplate=function(){return this.device.template},n.prototype.afterAttributeRender=function(t,e){var i;return(i=$(t)).addClass("attr-"+e.name).addClass("attr-type-"+e.type),i.parent(".attributes").addClass("contains-attr-"+e.name).addClass("contains-attr-type-"+e.type)},n.prototype.error=function(){return this.device===pimatic.nullDevice?"Could not find a device with id: "+this.templData.deviceId:null},n.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},n.prototype.labelTooltipHtml=function(){var t,e;return e="<div>ID: "+this.deviceId+"</div>\n<div>Class: "+this.device.config.class+"</div>",t=[],this.device.config.xLink&&t.push('<a href="'+this.device.config.xLink+'" target="_blank">Link</a>'),this.device.config.xButton&&t.push('<a href="#" id="to-device-xButton"\ndata-deviceId="'+this.device.id+'">'+this.device.config.xButton+"</a>"),this.device.hasAttibuteWith(function(t){var e;return"number"===(e=t.type)||"boolean"===e})&&t.push('<a href="#" id="to-graph-page"\ndata-deviceId="'+this.device.id+'">Graph</a>'),pimatic.hasPermission("devices","write")&&t.push('<a href="#" id="to-device-editor-page"\ndata-deviceId="'+this.device.id+'">Edit Device</a>'),t.length>0&&(e+="<div>"+t.join("")+"</div>"),e},n.prototype.getConfig=function(t){return null!=this.device.config[t]?this.device.config[t]:this.device.configDefaults[t]},n}(),m=function(e){function i(t,e){var n;if(this.device=e,i.__super__.constructor.call(this,t,this.device),this.switchId="switch-"+t.deviceId,null==(n=this.getAttribute("state")))throw new Error("A switch device needs an state attribute!");this.switchState=ko.observable(n.value()?"on":"off"),n.value.subscribe(function(t){return function(e){return t._restoringState=!0,t.switchState(e?"on":"off"),pimatic.try(function(){return t.sliderEle.flipswitch("refresh")}),t._restoringState=!1}}(this))}return t(i,s),i.prototype.onSwitchChange=function(){var t,e,i,n,r;if(!this._restoringState&&(n="on"===this.switchState(),r=this.getAttribute("state").value(),n!==r))return this.sliderEle.flipswitch("disable"),t="on"===this.switchState()?"turnOn":"turnOff",e=!this.device.config.xConfirm||confirm(__("Do you really want to turn %s?",this.device.name()+" "+__(this.switchState()))),i="on"===this.switchState()?"off":"on",e?(pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),this.device.rest[t]({},{global:!1}).done(ajaxShowToast).fail(function(t){return function(){return t._restoringState=!0,t.switchState(i),pimatic.try(function(){return t.sliderEle.flipswitch("refresh")}),t._restoringState=!1}}(this)).always(function(t){return function(){return pimatic.loading("switch-on-"+t.switchId,"hide"),pimatic.try(function(){return t.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):(this._restoringState=!0,this.switchState(i),pimatic.try(function(t){return function(){return t.sliderEle.flipswitch("enable")}}(this)),pimatic.try(function(t){return function(){return t.sliderEle.flipswitch("refresh")}}(this)),this._restoringState=!1)},i.prototype.afterRender=function(t){var e,n;return i.__super__.afterRender.call(this,t),this.sliderEle=$(t).find("select"),null!=(n=this.getAttribute("state")).labels&&(e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},this.sliderEle.find("option[value=on]").text(__(e(n.labels[0]))),this.sliderEle.find("option[value=off]").text(__(e(n.labels[1])))),this.sliderEle.flipswitch(),$(t).find(".ui-flipswitch").addClass("no-carousel-slide")},i}(),o=function(e){function i(t,e){var n,r;if(this.device=e,i.__super__.constructor.call(this,t,this.device),this.sliderId="switch-"+t.deviceId,null==(n=this.getAttribute("dimlevel")))throw new Error("A dimmer device needs an dimlevel attribute!");r=n.value,this.sliderValue=ko.observable(null!=r()?r():0),n.value.subscribe(function(t){return function(e){return t.sliderValue(e),pimatic.try(function(){return t.sliderEle.slider("refresh")})}}(this))}return t(i,s),i.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),this.device.rest.changeDimlevelTo({dimlevel:this.sliderValue()},{global:!1}).done(ajaxShowToast).fail(function(t){return function(){return pimatic.try(function(){return t.sliderEle.val(t.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(t){return function(){return pimatic.loading("dimming-"+t.sliderId,"hide"),pimatic.try(function(){return t.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},i.prototype.afterRender=function(t){return i.__super__.afterRender.call(this,t),this.sliderEle=$(t).find("input"),this.sliderEle.slider(),$(t).find(".ui-slider").addClass("no-carousel-slide")},i}(),f=function(e){function n(){return this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.apply(this,arguments)}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n}(),h=function(e){function n(t,e){this.device=e,this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.getAttribute("presence").value.subscribe(function(t){return function(){return t.updateClass()}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n.prototype.afterRender=function(t){return n.__super__.afterRender.call(this,t),this.presenceEle=$(t).find(".attr-presence"),this.updateClass()},n.prototype.updateClass=function(){var t;if(t=this.getAttribute("presence").value(),null!=this.presenceEle)switch(t){case!0:this.presenceEle.addClass("value-present"),this.presenceEle.removeClass("value-absent");break;case!1:this.presenceEle.removeClass("value-present"),this.presenceEle.addClass("value-absent");break;default:this.presenceEle.removeClass("value-absent"),this.presenceEle.removeClass("value-present")}},n}(),r=function(e){function n(){return this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.apply(this,arguments)}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n}(),d=function(e){function i(t,e){this.device=e,i.__super__.constructor.call(this,t,this.device),this.getAttribute("position").value.subscribe(function(t){return function(e){return t._updateButtons(e)}}(this))}return t(i,s),i.prototype.onShutterDownClicked=function(){return"down"===this.getAttribute("position").value()?this._ajaxCall("stop"):!this.device.config.xConfirm||confirm(__('Do you really want to press "%s"?',__("down")))?this._ajaxCall("moveDown"):void 0},i.prototype.onShutterUpClicked=function(){return"up"===this.getAttribute("position").value()?this._ajaxCall("stop"):!this.device.config.xConfirm||confirm(__('Do you really want to press "%s"?',__("up")))?this._ajaxCall("moveUp"):void 0},i.prototype._ajaxCall=function(t){var e;return e=function(){switch(t){case"moveUp":return"moving up";case"moveDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(e)}),this.device.rest[t]({},{global:!1}).done(ajaxShowToast).always(function(t){return function(){return pimatic.loading("shutter-"+t.deviceId,"hide"),t.downBtn.removeClass("ui-state-disabled"),t.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},i.prototype._updateButtons=function(t){if(null!=this.downBtn)switch(t){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},i.prototype.afterRender=function(t){var e;if(i.__super__.afterRender.call(this,t),this.downBtn=$(t).find(".shutter-down"),this.upBtn=$(t).find(".shutter-up"),null!=(e=this.getAttribute("position").value()))return this._updateButtons(e)},i}(),u=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.type=this.getConfig("type"),this.inputValue=ko.observable(),this.inputAttr=this.getAttribute("input"),this.inputValue(this.inputAttr.value()),n=this.inputAttr.value(),this.inputAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e,i;if(i=t.inputValue(),n!==i){if("string"===t.type)return t.changeInputTo(i);if("number"===t.type&&null!=i&&null!=n&&parseFloat(n)!==parseFloat(i))return e=parseFloat(i),isNaN(i)||e!==e?(swal("Oops...",__(i+" is not a number."),"error"),void t.inputValue(n)):t.changeInputTo(e)}}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})}return t(i,s),i.prototype.changeInputTo=function(t){return this.device.rest.changeInputTo({value:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(){})},i.prototype.afterRender=function(t){var e,n,r;return i.__super__.afterRender.call(this,t),this.input=$(t).find("input"),"number"===this.type?(n=this.getConfig("min"),e=this.getConfig("max"),r=this.getConfig("step"),null!=n&&this.input.attr("min",n),null!=e&&this.input.attr("max",e),this.input.attr("step",r),this.input.spinbox().autosizeInput({space:30})):this.input.autosizeInput({space:5})},i}(),c=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.type=this.getConfig("type"),this.inputValue=ko.observable(),this.inputAttr=this.getAttribute("input"),this.inputValue(this.inputAttr.value()),n=this.inputAttr.value(),this.inputAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e,i,r;if(i=t.inputValue(),r=/^([01]?[0-9]|2[0-3]):[0-5][0-9]/,e=/^[01]?[0-9]|2[0-3]/,n!==i)return i.match(r)?t.changeInputTo(i):i.match(e)?t.changeInputTo(i+":00"):swal("Oops...",__(i+" is not a vaild time."),"error")}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})}return t(i,s),i.prototype.changeInputTo=function(t){return this.device.rest.changeInputTo({value:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(){})},i.prototype.afterRender=function(t){var e,n,r;return i.__super__.afterRender.call(this,t),this.input=$(t).find("input"),n=this.getConfig("min"),e=this.getConfig("max"),r=this.getConfig("step"),null!=n&&this.input.attr("min",n),null!=e&&this.input.attr("max",e),this.input.attr("step",r),this.input.timebox().autosizeInput({space:10})},i}(),n=function(e){function n(t,e){this.device=e,this.onButtonPress=i(this.onButtonPress,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device)}return t(n,s),n.prototype.getItemTemplate=function(){return"buttons"},n.prototype.onButtonPress=function(t){if(!t.confirm||confirm(__('Do you really want to press "%s"?',t.text)))return this.device.rest.buttonPressed({buttonId:t.id},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},n}(),p=function(e){function n(t,e){this.device=e,this.togglePlay=i(this.togglePlay,this),this.sendPlayerAction=i(this.sendPlayerAction,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.currentTitle=this.device.getAttribute("currentTitle").value,this.playButtonIcon=ko.computed(function(t){return function(){return"play"===(0,t.device.getAttribute("state").value)()?"pause":"play"}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"musicplayer"},n.prototype.sendPlayerAction=function(t){return this.device.rest[t]({}).done(ajaxShowToast).fail(ajaxAlertFail)},n.prototype.togglePlay=function(){var t,e;return e=this.device.getAttribute("state").value,t="play"===e()?"pause":"play",this.sendPlayerAction(t)},n}(),v=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.inputValue=ko.observable(),this.stAttr=this.getAttribute("temperatureSetpoint"),this.inputValue(this.stAttr.value()),n=this.stAttr.value(),this.stAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e;if(null!=(e=t.inputValue())&&null!=n&&parseFloat(n)!==parseFloat(e))return t.changeTemperatureTo(parseFloat(e))}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.synced=this.getAttribute("synced").value}return t(i,s),i.prototype.afterRender=function(t){var e,n;i.__super__.afterRender.call(this,t),this.autoButton=$(t).find("[name=autoButton]"),this.manuButton=$(t).find("[name=manuButton]"),this.boostButton=$(t).find("[name=boostButton]"),this.ecoButton=$(t).find("[name=ecoButton]"),this.comfyButton=$(t).find("[name=comfyButton]"),this.input=$(t).find(".spinbox input"),this.valvePosition=$(t).find(".valve-position-bar"),this.input.spinbox(),this.updateButtons(),this.updatePreTemperature(),this.updateValvePosition(),null!=(e=this.getAttribute("mode"))&&e.value.subscribe(function(t){return function(){return t.updateButtons()}}(this)),this.stAttr.value.subscribe(function(t){return function(){return t.updatePreTemperature()}}(this)),null!=(n=this.getAttribute("valve"))&&n.value.subscribe(function(t){return function(){return t.updateValvePosition()}}(this))},i.prototype.modeAuto=function(){return this.changeModeTo("auto")},i.prototype.modeManu=function(){return this.changeModeTo("manu")},i.prototype.modeBoost=function(){return this.changeModeTo("boost")},i.prototype.modeEco=function(){return this.changeTemperatureTo(""+this.device.config.ecoTemp)},i.prototype.modeComfy=function(){return this.changeTemperatureTo(""+this.device.config.comfyTemp)},i.prototype.modeVac=function(){return this.changeTemperatureTo(""+this.device.config.vacTemp)},i.prototype.setTemp=function(){return this.changeTemperatureTo(""+this.inputValue.value())},i.prototype.updateButtons=function(){var t;switch(null!=(t=this.getAttribute("mode"))?t.value():void 0){case"auto":this.manuButton.removeClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.addClass("ui-btn-active");break;case"manu":this.manuButton.addClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active");break;case"boost":this.manuButton.removeClass("ui-btn-active"),this.boostButton.addClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active")}},i.prototype.updatePreTemperature=function(){parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.ecoTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.addClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active")):parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.comfyTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.addClass("ui-btn-active")):(this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"))},i.prototype.updateValvePosition=function(){var t,e;return null!=(e=null!=(t=this.getAttribute("valve"))?t.value():void 0)?(this.valvePosition.css("height",e+"%"),this.valvePosition.parent().css("display","")):this.valvePosition.parent().css("display","none")},i.prototype.changeModeTo=function(t){return this.device.rest.changeModeTo({mode:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},i.prototype.changeTemperatureTo=function(t){return this.input.spinbox("disable"),this.device.rest.changeTemperatureTo({temperatureSetpoint:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(t){return function(){return t.input.spinbox("enable")}}(this))},i}(),g=function(e){function n(t,e){this.device=e,this.toggleRunning=i(this.toggleRunning,this),this.sendTimerAction=i(this.sendTimerAction,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.startButtonIcon=ko.computed(function(t){return function(){return(0,t.device.getAttribute("running").value)()?"stop":"play"}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"timer"},n.prototype.sendTimerAction=function(t){return this.device.rest[t]({}).done(ajaxShowToast).fail(ajaxAlertFail)},n.prototype.toggleRunning=function(){var t,e;return e=this.device.getAttribute("running").value,t=e()?"stopTimer":"startTimer",this.sendTimerAction(t)},n}(),pimatic.Item=l,pimatic.HeaderItem=a,pimatic.ButtonsItem=n,pimatic.DeviceItem=s,pimatic.SwitchItem=m,pimatic.DimmerItem=o,pimatic.TemperatureItem=f,pimatic.PresenceItem=h,pimatic.ShutterItem=d,pimatic.ContactItem=r,pimatic.MuscicplayerItem=p,pimatic.ThermostatItem=v,pimatic.TimerItem=g,pimatic.InputItem=u,pimatic.InputTimeItem=c,pimatic.templateClasses={null:pimatic.DeviceItem,header:pimatic.HeaderItem,buttons:pimatic.ButtonsItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,switch:pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem,musicplayer:pimatic.MuscicplayerItem,thermostat:pimatic.ThermostatItem,timer:pimatic.TimerItem,input:pimatic.InputItem,inputTime:pimatic.InputTimeItem},$(document).trigger("templateinit",[]),$(document).trigger("templateready",[]))})}).call(this);;
(function(){var lastCarouselWidth,tc,updateCarousel,bind=function(e,t){return function(){return e.apply(t,arguments)}},indexOf=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};tc=pimatic.tryCatch,$(document).on("pagecreate","#index",tc(function(event){var IndexViewModel,e,error,indexPage,ref;IndexViewModel=function(){function e(){this.isGroupCollapsed=bind(this.isGroupCollapsed,this),this.createToggleGroupCallback=bind(this.createToggleGroupCallback,this),this.onDropItemOnTrash=bind(this.onDropItemOnTrash,this),this.onItemsSorted=bind(this.onItemsSorted,this),this.toggleEditing=bind(this.toggleEditing,this),this.onLogoutClicked=bind(this.onLogoutClicked,this),this.onLogMessageClicked=bind(this.onLogMessageClicked,this),this.onAddItemClicked=bind(this.onAddItemClicked,this),this.showDevicePage=bind(this.showDevicePage,this),this.getItemTemplate=bind(this.getItemTemplate,this);var t,i,n,o,a,r,s,c,d,l,u,p;if(this.groups=pimatic.groups,this.hasPermission=pimatic.hasPermission,this.updateFromJs({ruleItemCssClass:"",hasRootCACert:!1,collapsedGroups:{}}),this.lockButton=ko.computed(tc(function(e){return function(){var t;return t=e.enabledEditing(),{icon:t?"check":"gear"}}}(this))),this.logoutText=ko.computed(tc(function(){return"string"==typeof pimatic.username()?__("Logout")+" ("+pimatic.username()+")":__("Logout")})),s=null,r=null,o=null,a={offset:40,tolerance:10,classes:{initial:"animated",pinned:"slideDown",unpinned:"slideUp"}},d=null,c=null,p=null,u=function(e){return function(t){var i,n,o;if(null==t&&(t=!0),null!=s&&null!=r)return n=null!=e.activeDevicepage()?e.devicepages.indexOf(e.activeDevicepage()):0,(o=$(r.find(".items")[n]).width())!==d&&s.css({width:o}),(i=s.height())!==c&&r.find(".items").each(function(){return $(this).parent().css("padding-top",i)}),clearTimeout(p),t&&(p=setTimeout(function(){return u(!1)},350)),d=o,c=i}}(this),this.devicepagesTabsRefresh=ko.computed(tc(function(e){return function(){var t,i,n,r,c,d;if(e.bindingsApplied())return t=e.devicepages(),i=e.enabledEditing(),s=$("#item-tabs"),null!=o&&o.destroy(),pimatic.try(function(){return s.navbar("destroy")}),ko.cleanNode(s[0]),r=t.length>0&&e.hasPermission("pages","read")?"<ul data-bind=\"foreach: devicepages\">\n  <li class=\"page-tab\">\n    <a \n      data-ajax='false' \n      data-bind=\"\n        attr: {\n          href: '#item-tab-'+$data.id\n        }, \n        text: name, \n        css: {'ui-btn-active': $data == $root.activeDevicepage()}\n      \"\n    ></a>\n  </li>\n</ul>":"<ul></ul>",s.html(r),ko.applyBindings(e,s[0]),i&&s.find("ul").append($("#edit-devicepage-link-template").text()),(t.length>0||e.enabledEditing())&&e.hasPermission("pages","read")&&(s.navbar(),s.find("ul").removeClass("ui-grid-a ui-grid-duo"),(d=s.find("li")).length<=6?(c=100/d.length+"%",n=d.length):(n=Math.ceil(d.length/2),c=100/n+"%"),d.each(function(e){var t;if($(this).css({width:c,clear:"none"}).removeClass("ui-block-a ui-block-b ui-block-c ui-block-d ui-block-e").addClass("ui-block-a"),t=$(this).find("a"),e+1>n)return t.css("border-top-width",0)}),(o=new Headroom(s[0],a)).init()),u()}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),l=function(e){return function(){var t;if(null!=o&&null!=e.activeDevicepage())return o.destroy(),t=e.devicepages.indexOf(e.activeDevicepage()),a.scroller=r.find(".owl-wrapper .owl-item")[t],(o=new Headroom(s[0],a)).init()}}(this),t=[],ko.computed(tc(function(e){return function(){var i,n,o,a,s,c,d,p;if(e.bindingsApplied()){for(n=e.devicepages(),o=ko.utils.compareArrays(n,t),t=function(){var e,t,i;for(i=[],e=0,t=n.length;e<t;e++)p=n[e],i.push(p);return i}(),i=!1,s=0,c=o.length;s<c;s++)if("retained"!==o[s].status){i=!0;break}i&&(r=$("#item-lists"),ko.cleanNode(r[0]),null!=(d=r.data("owlCarousel"))&&d.destroy(),n.length>0&&e.hasPermission("pages","read")?(a=$("#devicepages-template").text(),r.html(a),null!=ko.dataFor($("#index")[0])&&ko.applyBindings(e,r[0]),r.find('[data-role="listview"]').listview(),r.owlCarousel({slideSpeed:300,paginationSpeed:400,singleItem:!0,pagination:!1,navigation:!1,lazyEffect:!1,lazyLoad:!1,afterAction:function(){},afterMove:function(t){var i;return i=t.data("owlCarousel").currentItem,e.activeDevicepage(e.devicepages()[i])},afterUpdate:function(){return u()}}),r.width(),l()):r.html(""),u())}}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.activeDevicepage.subscribe(function(e){return function(t){var i,n;if(null!=t&&null!=(n=$("#item-lists").data("owlCarousel"))&&-1!==(i=e.devicepages.indexOf(t)))return n.goTo(i),l(),u()}}(this)),ko.computed(function(e){return function(){var t,i;return 0===(t=e.devicepages()).length?e.activeDevicepage(null):null==e.activeDevicepage()?e.activeDevicepage(t[0]):(i=e.activeDevicepage(),indexOf.call(t,i)>=0?void 0:e.activeDevicepage(t[0]))}}(this)),this.itemsListViewRefresh=ko.computed(tc(function(e){return function(){var t,i,n,o,a,r;for(t=0,n=(a=e.devicepages()).length;t<n;t++)a[t].devices();for(i=0,o=(r=pimatic.groups()).length;i<o;i++)r[i].devices();return e.isSortingItems(),e.enabledEditing(),e.collapsedGroups(),pimatic.try(function(){return $('#item-lists [data-role="listview"]').each(function(){var e;return null==(e=$(this)).data("mobileListview")?e.listview():e.listview("refresh")})})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.deviepagesRefresh=ko.computed(tc(function(e){return function(){return e.devicepages(),pimatic.try(function(){return $(".nav-panel-menu").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),pimatic.storage.isSet("pimatic.indexPage")){i=pimatic.storage.get("pimatic.indexPage");try{this.updateFromJs(i)}catch(e){n=e,TraceKit.report(n),pimatic.storage.removeAll(),window.location.reload()}}this.autosave=ko.computed(function(t){return function(){return i=ko.mapper.toJS(t,e.mapping),pimatic.storage.set("pimatic.indexPage",i)}}(this)).extend({rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}),this.toggleEditingText=ko.computed(tc(function(e){return function(){return e.enabledEditing()?__("Lock lists"):__("Edit lists")}}(this)))}return e.mapping={$default:"ignore",ruleItemCssClass:"observe",hasRootCACert:"observe",collapsedGroups:"observe"},e.prototype.devicepages=pimatic.devicepages,e.prototype.errorCount=pimatic.errorCount,e.prototype.activeDevicepage=ko.observable(null),e.prototype.isSortingItems=ko.observable(!1),e.prototype.enabledEditing=ko.observable(!1),e.prototype.bindingsApplied=ko.observable(!1),e.prototype.getItemTemplate=function(e){return e.getItemTemplate()+"-template"},e.prototype.showDevicePage=function(e){return this.activeDevicepage(e),$("#nav-panel").panel("close"),!0},e.prototype.updateFromJs=function(t){return ko.mapper.fromJS(t,e.mapping,this)},e.prototype.onAddItemClicked=function(){return!0},e.prototype.onLogMessageClicked=function(){return jQuery.mobile.pageParams={selectErrors:!0},!0},e.prototype.onLogoutClicked=function(){return $.ajax({type:"GET",url:"/logout"}).fail(function(e,t,i){return"Unauthorized"===t||"Unauthorized"===i?setTimeout(function(){return pimatic.storage.removeAll(),pimatic.showToast(e.responseText),window.location.reload()},100):ajaxAlertFail(e,t,i)}),!1},e.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing())},e.prototype.onItemsSorted=function(e,t,i){var n,o,a,r,s,c;if(n=function(t,i){var n,o;return-1===(o=null==i?0:ko.utils.arrayIndexOf(t.devices(),i.device.id)+1)&&(o=0),n=t.id,pimatic.client.rest.addDeviceToGroup({deviceId:e.device.id,groupId:n,position:o}).done(ajaxShowToast).fail(ajaxAlertFail)},s=function(t){var i;return i=t.id,pimatic.client.rest.removeDeviceFromGroup({deviceId:e.device.id,groupId:i}).done(ajaxShowToast).fail(ajaxAlertFail)},c=function(t){return function(i){var n,o,a,r,s;for(n=[],null==i&&n.push(e.device.id),a=0,r=(s=t.activeDevicepage().devices()).length;a<r;a++)(o=s[a])!==e&&(n.push(o.device.id),null!=i&&o===i&&n.push(e.device.id));return pimatic.client.rest.updatePage({pageId:t.activeDevicepage().id,page:{devicesOrder:n}}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this),null!=t)return o=t instanceof pimatic.DeviceItem?t.device.group():t instanceof pimatic.Group?t:null,r=t instanceof pimatic.DeviceItem?t:void 0,a=e.device.group(),o!==a?null!=o?(n(o,r),c(r)):null!=a?(s(a),c(r)):c(r):c(r)},e.prototype.onDropItemOnTrash=function(e){if(confirm(__("Do you really want to delete the item?")))return function(t){return function(){var i;return i=t.activeDevicepage(),pimatic.loading("deleteitem","show",{text:__("Saving")}),pimatic.client.rest.removeDeviceFromPage({deviceId:e.deviceId,pageId:i.id}).always(function(){return pimatic.loading("deleteitem","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this)()},e.prototype.createToggleGroupCallback=function(e,t){var i;return i=e.id+"$"+t.id,function(e){return function(){var t;return(t=e.collapsedGroups())[i]?delete t[i]:t[i]=!0,e.collapsedGroups(t),!1}}(this)},e.prototype.isGroupCollapsed=function(e,t){var i;return i=e.id+"$"+t.id,!0===this.collapsedGroups()[i]},e}(),pimatic.pages.index=indexPage=new IndexViewModel;try{ko.applyBindings(indexPage,$("#index")[0]),indexPage.bindingsApplied(!0)}catch(error){e=error,TraceKit.report(e),null!=(ref=pimatic.storage)&&ref.removeAll(),window.location.reload()}$("#index").on("vclick",".page-tab",tc(function(e){var t;return t=ko.dataFor(this),indexPage.activeDevicepage(t),!1})),$("#index").on("change","#item-lists .switch",tc(function(e){ko.dataFor(this).onSwitchChange()})),$("#index").on("slidestop"," #item-lists .dimmer",tc(function(e){ko.dataFor(this).onSliderStop()})),$("#index").on("vclick","#item-lists .shutter-down",tc(function(e){return ko.dataFor(this).onShutterDownClicked(),!1})),$("#index").on("vclick","#item-lists .shutter-up",tc(function(e){return ko.dataFor(this).onShutterUpClicked(),!1})),$("#index").on("vclick","#item-tabs #add-devicepage-link",tc(function(e){return indexPage.onAddPageClicked(),!0})),$("#items .handle").disableSelection(),$("#nav-panel").on("panelopen panelclose",tc(function(e){if($("#item-lists").is(":visible"))return updateCarousel()})),$(document).on("vclick","#to-graph-page",function(){var e,t;return t=$("#to-graph-page").attr("data-deviceId"),e=pimatic.getDeviceById(t),jQuery.mobile.pageParams={device:e},jQuery.mobile.changePage("#graph-page",{transition:"slide"})}),$(document).on("vclick","#to-device-editor-page",function(){var e,t;return t=$("#to-device-editor-page").attr("data-deviceId"),e=pimatic.getDeviceById(t),jQuery.mobile.pageParams={action:"update",device:e,back:"#index"},jQuery.mobile.changePage("#edit-device-page",{transition:"slide"})}),$(document).on("vclick","#to-device-xButton",function(){var device,deviceId;return deviceId=$("#to-device-xButton").attr("data-deviceId"),(device=pimatic.getDeviceById(deviceId)).rest.xButton({}).done(function(_this){return function(response){if(response.success)return eval(response.result);throw new Error("xButton call failed: "+response.result+"!")}}(this)).fail(ajaxAlertFail)})})),lastCarouselWidth=0,updateCarousel=function(){return pimatic.try(function(){var e,t;return e=$("#item-lists"),(t=e.width())!==lastCarouselWidth&&e.data("owlCarousel").updateVars(),lastCarouselWidth=t})},$(document).on("click",".content-overlay",tc(function(e){return $("#nav-panel").panel("close")})),$(document).on("pageshow","#index",tc(function(e){return updateCarousel(),setTimeout(function(){return updateCarousel(),$.mobile.resetActivePageHeight()},1)})),$(document).on("pagebeforeshow","#index",tc(function(e){return setTimeout(function(){return pimatic.try(function(){return $("#nav-panel").find('[data-role="listview"]').listview("refresh")}),pimatic.try(function(){return $("#item-lists").find('[data-role="listview"]').listview("refresh")}),pimatic.try(function(){return $("#item-tabs").navbar()})},2)}))}).call(this);;
(function(){var i;i=pimatic.tryCatch,$(document).ready(i(function(i){var e;return e=function(){function i(){}return i.prototype.showLoginDialog=function(){var i;return this.redirectPage=(null!=(i=$.mobile.activePage)?i.attr("id"):void 0)||"index","login-page"===this.redirectPage&&(this.redirectPage="index"),pimatic.socket.io.disconnect(),jQuery.mobile.changePage("#login-page",{transition:"flip"})},i.prototype.hideLoginDialog=function(){var i;if("login-page"===((null!=(i=$.mobile.activePage)?i.attr("id"):void 0)||"index"))return jQuery.mobile.changePage("#"+(this.redirectPage||"index"),{transition:"flip"})},i}(),pimatic.pages.login=new e})),$(document).on("pagebeforeshow","#login-page",function(i){var e,n,o;return null==(null!=(e=pimatic.socket.io)?e.connected:void 0)||0===(null!=(n=pimatic.socket.io)&&null!=(o=n.connected)?o.length:void 0)||(pimatic.pages.login.hideLoginDialog(),!1)}),$(document).on("pageshow","#login-page",function(i){return $("#loginForm  #firstName").focus()}),$(document).on("submit","#login-page #loginForm",i(function(i){return $("#loginForm #rememberMe").val(),pimatic.loading("socket","show",{text:__("Logging in"),blocking:!0}),$.ajax({type:"POST",url:"/login",data:$("#loginForm").serialize(),global:!1}).done(function(i){return pimatic.loading("socket","show",{text:__("Connecting"),blocking:!0}),setTimeout(function(){return pimatic.rememberme(i.rememberMe),pimatic.socket.io.reconnection(!0),pimatic.socket.io.connect()},1)}).fail(function(){return pimatic.loading("socket","hide")}).fail(ajaxAlertFail),i.preventDefault(),!1}))}).call(this);