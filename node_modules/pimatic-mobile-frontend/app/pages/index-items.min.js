(function(){var t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},e={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}};$(document).on("pagebeforecreate",function(e){var n,r,s,o,a,u,c,l,p,h,d,m,f,v,g,b;null==pimatic.templateClasses&&(b=$("#sortable-handle-template").text(),l=function(){function t(t){this.templData=t,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)}return t.prototype.update=function(t){return this.templData=t,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)},t.prototype.afterRender=function(t){return $(t).addClass("item").find("label").before($(b))},t}(),a=function(e){function i(t){var e,i,n,r;if(0===t.length)this.title="Ungrouped";else for(this.title="",i=n=0,r=t.length;n<r;i=++n)e=t[i],0!==i&&(this.title+=", "),this.title+=e.name()}return t(i,l),i.prototype.afterRender=function(){},i.prototype.getItemTemplate=function(){return"header"},i}(),s=function(e){function n(t,e){this.device=e,this.labelTooltipHtml=i(this.labelTooltipHtml,this),n.__super__.constructor.call(this,t),this.name=this.device.name,this.deviceId=t.deviceId}return t(n,l),n.mapping={$default:"ignore",deviceId:"copy"},n.prototype.getAttribute=function(t){return this.device.getAttribute(t)},n.prototype.getItemTemplate=function(){return this.device.template},n.prototype.afterAttributeRender=function(t,e){var i;return(i=$(t)).addClass("attr-"+e.name).addClass("attr-type-"+e.type),i.parent(".attributes").addClass("contains-attr-"+e.name).addClass("contains-attr-type-"+e.type)},n.prototype.error=function(){return this.device===pimatic.nullDevice?"Could not find a device with id: "+this.templData.deviceId:null},n.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},n.prototype.labelTooltipHtml=function(){var t,e;return e="<div>ID: "+this.deviceId+"</div>\n<div>Class: "+this.device.config.class+"</div>",t=[],this.device.config.xLink&&t.push('<a href="'+this.device.config.xLink+'" target="_blank">Link</a>'),this.device.config.xButton&&t.push('<a href="#" id="to-device-xButton"\ndata-deviceId="'+this.device.id+'">'+this.device.config.xButton+"</a>"),this.device.hasAttibuteWith(function(t){var e;return"number"===(e=t.type)||"boolean"===e})&&t.push('<a href="#" id="to-graph-page"\ndata-deviceId="'+this.device.id+'">Graph</a>'),pimatic.hasPermission("devices","write")&&t.push('<a href="#" id="to-device-editor-page"\ndata-deviceId="'+this.device.id+'">Edit Device</a>'),t.length>0&&(e+="<div>"+t.join("")+"</div>"),e},n.prototype.getConfig=function(t){return null!=this.device.config[t]?this.device.config[t]:this.device.configDefaults[t]},n}(),m=function(e){function i(t,e){var n;if(this.device=e,i.__super__.constructor.call(this,t,this.device),this.switchId="switch-"+t.deviceId,null==(n=this.getAttribute("state")))throw new Error("A switch device needs an state attribute!");this.switchState=ko.observable(n.value()?"on":"off"),n.value.subscribe(function(t){return function(e){return t._restoringState=!0,t.switchState(e?"on":"off"),pimatic.try(function(){return t.sliderEle.flipswitch("refresh")}),t._restoringState=!1}}(this))}return t(i,s),i.prototype.onSwitchChange=function(){var t,e,i,n,r;if(!this._restoringState&&(n="on"===this.switchState(),r=this.getAttribute("state").value(),n!==r))return this.sliderEle.flipswitch("disable"),t="on"===this.switchState()?"turnOn":"turnOff",e=!this.device.config.xConfirm||confirm(__("Do you really want to turn %s?",this.device.name()+" "+__(this.switchState()))),i="on"===this.switchState()?"off":"on",e?(pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),this.device.rest[t]({},{global:!1}).done(ajaxShowToast).fail(function(t){return function(){return t._restoringState=!0,t.switchState(i),pimatic.try(function(){return t.sliderEle.flipswitch("refresh")}),t._restoringState=!1}}(this)).always(function(t){return function(){return pimatic.loading("switch-on-"+t.switchId,"hide"),pimatic.try(function(){return t.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):(this._restoringState=!0,this.switchState(i),pimatic.try(function(t){return function(){return t.sliderEle.flipswitch("enable")}}(this)),pimatic.try(function(t){return function(){return t.sliderEle.flipswitch("refresh")}}(this)),this._restoringState=!1)},i.prototype.afterRender=function(t){var e,n;return i.__super__.afterRender.call(this,t),this.sliderEle=$(t).find("select"),null!=(n=this.getAttribute("state")).labels&&(e=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},this.sliderEle.find("option[value=on]").text(__(e(n.labels[0]))),this.sliderEle.find("option[value=off]").text(__(e(n.labels[1])))),this.sliderEle.flipswitch(),$(t).find(".ui-flipswitch").addClass("no-carousel-slide")},i}(),o=function(e){function i(t,e){var n,r;if(this.device=e,i.__super__.constructor.call(this,t,this.device),this.sliderId="switch-"+t.deviceId,null==(n=this.getAttribute("dimlevel")))throw new Error("A dimmer device needs an dimlevel attribute!");r=n.value,this.sliderValue=ko.observable(null!=r()?r():0),n.value.subscribe(function(t){return function(e){return t.sliderValue(e),pimatic.try(function(){return t.sliderEle.slider("refresh")})}}(this))}return t(i,s),i.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),this.device.rest.changeDimlevelTo({dimlevel:this.sliderValue()},{global:!1}).done(ajaxShowToast).fail(function(t){return function(){return pimatic.try(function(){return t.sliderEle.val(t.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(t){return function(){return pimatic.loading("dimming-"+t.sliderId,"hide"),pimatic.try(function(){return t.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},i.prototype.afterRender=function(t){return i.__super__.afterRender.call(this,t),this.sliderEle=$(t).find("input"),this.sliderEle.slider(),$(t).find(".ui-slider").addClass("no-carousel-slide")},i}(),f=function(e){function n(){return this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.apply(this,arguments)}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n}(),h=function(e){function n(t,e){this.device=e,this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.getAttribute("presence").value.subscribe(function(t){return function(){return t.updateClass()}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n.prototype.afterRender=function(t){return n.__super__.afterRender.call(this,t),this.presenceEle=$(t).find(".attr-presence"),this.updateClass()},n.prototype.updateClass=function(){var t;if(t=this.getAttribute("presence").value(),null!=this.presenceEle)switch(t){case!0:this.presenceEle.addClass("value-present"),this.presenceEle.removeClass("value-absent");break;case!1:this.presenceEle.removeClass("value-present"),this.presenceEle.addClass("value-absent");break;default:this.presenceEle.removeClass("value-absent"),this.presenceEle.removeClass("value-present")}},n}(),r=function(e){function n(){return this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.apply(this,arguments)}return t(n,s),n.prototype.getItemTemplate=function(){return"device"},n}(),d=function(e){function i(t,e){this.device=e,i.__super__.constructor.call(this,t,this.device),this.getAttribute("position").value.subscribe(function(t){return function(e){return t._updateButtons(e)}}(this))}return t(i,s),i.prototype.onShutterDownClicked=function(){return"down"===this.getAttribute("position").value()?this._ajaxCall("stop"):!this.device.config.xConfirm||confirm(__('Do you really want to press "%s"?',__("down")))?this._ajaxCall("moveDown"):void 0},i.prototype.onShutterUpClicked=function(){return"up"===this.getAttribute("position").value()?this._ajaxCall("stop"):!this.device.config.xConfirm||confirm(__('Do you really want to press "%s"?',__("up")))?this._ajaxCall("moveUp"):void 0},i.prototype._ajaxCall=function(t){var e;return e=function(){switch(t){case"moveUp":return"moving up";case"moveDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(e)}),this.device.rest[t]({},{global:!1}).done(ajaxShowToast).always(function(t){return function(){return pimatic.loading("shutter-"+t.deviceId,"hide"),t.downBtn.removeClass("ui-state-disabled"),t.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},i.prototype._updateButtons=function(t){if(null!=this.downBtn)switch(t){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},i.prototype.afterRender=function(t){var e;if(i.__super__.afterRender.call(this,t),this.downBtn=$(t).find(".shutter-down"),this.upBtn=$(t).find(".shutter-up"),null!=(e=this.getAttribute("position").value()))return this._updateButtons(e)},i}(),u=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.type=this.getConfig("type"),this.inputValue=ko.observable(),this.inputAttr=this.getAttribute("input"),this.inputValue(this.inputAttr.value()),n=this.inputAttr.value(),this.inputAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e,i;if(i=t.inputValue(),n!==i){if("string"===t.type)return t.changeInputTo(i);if("number"===t.type&&null!=i&&null!=n&&parseFloat(n)!==parseFloat(i))return e=parseFloat(i),isNaN(i)||e!==e?(swal("Oops...",__(i+" is not a number."),"error"),void t.inputValue(n)):t.changeInputTo(e)}}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})}return t(i,s),i.prototype.changeInputTo=function(t){return this.device.rest.changeInputTo({value:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(){})},i.prototype.afterRender=function(t){var e,n,r;return i.__super__.afterRender.call(this,t),this.input=$(t).find("input"),"number"===this.type?(n=this.getConfig("min"),e=this.getConfig("max"),r=this.getConfig("step"),null!=n&&this.input.attr("min",n),null!=e&&this.input.attr("max",e),this.input.attr("step",r),this.input.spinbox().autosizeInput({space:30})):this.input.autosizeInput({space:5})},i}(),c=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.type=this.getConfig("type"),this.inputValue=ko.observable(),this.inputAttr=this.getAttribute("input"),this.inputValue(this.inputAttr.value()),n=this.inputAttr.value(),this.inputAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e,i,r;if(i=t.inputValue(),r=/^([01]?[0-9]|2[0-3]):[0-5][0-9]/,e=/^[01]?[0-9]|2[0-3]/,n!==i)return i.match(r)?t.changeInputTo(i):i.match(e)?t.changeInputTo(i+":00"):swal("Oops...",__(i+" is not a vaild time."),"error")}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})}return t(i,s),i.prototype.changeInputTo=function(t){return this.device.rest.changeInputTo({value:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(){})},i.prototype.afterRender=function(t){var e,n,r;return i.__super__.afterRender.call(this,t),this.input=$(t).find("input"),n=this.getConfig("min"),e=this.getConfig("max"),r=this.getConfig("step"),null!=n&&this.input.attr("min",n),null!=e&&this.input.attr("max",e),this.input.attr("step",r),this.input.timebox().autosizeInput({space:10})},i}(),n=function(e){function n(t,e){this.device=e,this.onButtonPress=i(this.onButtonPress,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device)}return t(n,s),n.prototype.getItemTemplate=function(){return"buttons"},n.prototype.onButtonPress=function(t){if(!t.confirm||confirm(__('Do you really want to press "%s"?',t.text)))return this.device.rest.buttonPressed({buttonId:t.id},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},n}(),p=function(e){function n(t,e){this.device=e,this.togglePlay=i(this.togglePlay,this),this.sendPlayerAction=i(this.sendPlayerAction,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.currentTitle=this.device.getAttribute("currentTitle").value,this.playButtonIcon=ko.computed(function(t){return function(){return"play"===(0,t.device.getAttribute("state").value)()?"pause":"play"}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"musicplayer"},n.prototype.sendPlayerAction=function(t){return this.device.rest[t]({}).done(ajaxShowToast).fail(ajaxAlertFail)},n.prototype.togglePlay=function(){var t,e;return e=this.device.getAttribute("state").value,t="play"===e()?"pause":"play",this.sendPlayerAction(t)},n}(),v=function(e){function i(t,e){var n;this.device=e,i.__super__.constructor.call(this,t,this.device),this.inputValue=ko.observable(),this.stAttr=this.getAttribute("temperatureSetpoint"),this.inputValue(this.stAttr.value()),n=this.stAttr.value(),this.stAttr.value.subscribe(function(t){return function(e){return t.inputValue(e),n=e}}(this)),ko.computed(function(t){return function(){var e;if(null!=(e=t.inputValue())&&null!=n&&parseFloat(n)!==parseFloat(e))return t.changeTemperatureTo(parseFloat(e))}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.synced=this.getAttribute("synced").value}return t(i,s),i.prototype.afterRender=function(t){var e,n;i.__super__.afterRender.call(this,t),this.autoButton=$(t).find("[name=autoButton]"),this.manuButton=$(t).find("[name=manuButton]"),this.boostButton=$(t).find("[name=boostButton]"),this.ecoButton=$(t).find("[name=ecoButton]"),this.comfyButton=$(t).find("[name=comfyButton]"),this.input=$(t).find(".spinbox input"),this.valvePosition=$(t).find(".valve-position-bar"),this.input.spinbox(),this.updateButtons(),this.updatePreTemperature(),this.updateValvePosition(),null!=(e=this.getAttribute("mode"))&&e.value.subscribe(function(t){return function(){return t.updateButtons()}}(this)),this.stAttr.value.subscribe(function(t){return function(){return t.updatePreTemperature()}}(this)),null!=(n=this.getAttribute("valve"))&&n.value.subscribe(function(t){return function(){return t.updateValvePosition()}}(this))},i.prototype.modeAuto=function(){return this.changeModeTo("auto")},i.prototype.modeManu=function(){return this.changeModeTo("manu")},i.prototype.modeBoost=function(){return this.changeModeTo("boost")},i.prototype.modeEco=function(){return this.changeTemperatureTo(""+this.device.config.ecoTemp)},i.prototype.modeComfy=function(){return this.changeTemperatureTo(""+this.device.config.comfyTemp)},i.prototype.modeVac=function(){return this.changeTemperatureTo(""+this.device.config.vacTemp)},i.prototype.setTemp=function(){return this.changeTemperatureTo(""+this.inputValue.value())},i.prototype.updateButtons=function(){var t;switch(null!=(t=this.getAttribute("mode"))?t.value():void 0){case"auto":this.manuButton.removeClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.addClass("ui-btn-active");break;case"manu":this.manuButton.addClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active");break;case"boost":this.manuButton.removeClass("ui-btn-active"),this.boostButton.addClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active")}},i.prototype.updatePreTemperature=function(){parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.ecoTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.addClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active")):parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.comfyTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.addClass("ui-btn-active")):(this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"))},i.prototype.updateValvePosition=function(){var t,e;return null!=(e=null!=(t=this.getAttribute("valve"))?t.value():void 0)?(this.valvePosition.css("height",e+"%"),this.valvePosition.parent().css("display","")):this.valvePosition.parent().css("display","none")},i.prototype.changeModeTo=function(t){return this.device.rest.changeModeTo({mode:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},i.prototype.changeTemperatureTo=function(t){return this.input.spinbox("disable"),this.device.rest.changeTemperatureTo({temperatureSetpoint:t},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(t){return function(){return t.input.spinbox("enable")}}(this))},i}(),g=function(e){function n(t,e){this.device=e,this.toggleRunning=i(this.toggleRunning,this),this.sendTimerAction=i(this.sendTimerAction,this),this.getItemTemplate=i(this.getItemTemplate,this),n.__super__.constructor.call(this,t,this.device),this.startButtonIcon=ko.computed(function(t){return function(){return(0,t.device.getAttribute("running").value)()?"stop":"play"}}(this))}return t(n,s),n.prototype.getItemTemplate=function(){return"timer"},n.prototype.sendTimerAction=function(t){return this.device.rest[t]({}).done(ajaxShowToast).fail(ajaxAlertFail)},n.prototype.toggleRunning=function(){var t,e;return e=this.device.getAttribute("running").value,t=e()?"stopTimer":"startTimer",this.sendTimerAction(t)},n}(),pimatic.Item=l,pimatic.HeaderItem=a,pimatic.ButtonsItem=n,pimatic.DeviceItem=s,pimatic.SwitchItem=m,pimatic.DimmerItem=o,pimatic.TemperatureItem=f,pimatic.PresenceItem=h,pimatic.ShutterItem=d,pimatic.ContactItem=r,pimatic.MuscicplayerItem=p,pimatic.ThermostatItem=v,pimatic.TimerItem=g,pimatic.InputItem=u,pimatic.InputTimeItem=c,pimatic.templateClasses={null:pimatic.DeviceItem,header:pimatic.HeaderItem,buttons:pimatic.ButtonsItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,switch:pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem,musicplayer:pimatic.MuscicplayerItem,thermostat:pimatic.ThermostatItem,timer:pimatic.TimerItem,input:pimatic.InputItem,inputTime:pimatic.InputTimeItem},$(document).trigger("templateinit",[]),$(document).trigger("templateready",[]))})}).call(this);