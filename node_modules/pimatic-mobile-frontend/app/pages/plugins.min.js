(function(){var t,i=function(t,i){return function(){return t.apply(i,arguments)}};t=pimatic.tryCatch,$(document).on("pagebeforecreate","#plugins-page",function(e){var n,s;if(null==pimatic.pages.plugins){n=function(){function e(){this.refresh=i(this.refresh,this),this.onInstallClick=i(this.onInstallClick,this),this.onSettingsClick=i(this.onSettingsClick,this),this.onUninstallClick=i(this.onUninstallClick,this),this.onDeactivateClick=i(this.onDeactivateClick,this),this.onActivateClick=i(this.onActivateClick,this);var e;this.hasPermission=pimatic.hasPermission,this.updateProcessStatus=pimatic.updateProcessStatus,this.updateFromJs({installedPlugins:[],browsePlugins:[]}),this.updateListView=ko.computed(t(function(t){return function(){return t.installedPlugins(),pimatic.try(function(){return $("#plugin-list").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),e=this.updateProcessStatus(),this.updateProcessStatus.subscribe(function(t){return function(i){return"running"===e&&(i="done")&&t.refresh(),e=i}}(this))}return e.mapping={$default:"ignore",installedPlugins:{$key:"name",$itemOptions:{$default:"copy",loaded:"observe",activated:"observe"}},browsePlugins:{$key:"name",$itemOptions:{$default:"copy",installed:"observe",loaded:"observe",activated:"observe"}}},e.prototype.restartRequired=ko.observable(!1),e.prototype.updateFromJs=function(t){return ko.mapper.fromJS(t,e.mapping,this)},e.prototype.onActivateClick=function(t){return this.hasPermission("plugins","write")?(pimatic.client.rest.getPluginConfig({pluginName:t.name}).always(function(i){return function(e){if(null!=e.success)return null==e.config?(jQuery.mobile.pageParams={action:"add",pluginName:t.name},jQuery.mobile.changePage("#edit-plugin-page")):pimatic.client.rest.setPluginActivated({pluginName:t.name,active:!0}).done(function(e){if(e.success)return t.activated(!0),i.restartRequired(!0)})}}(this)),!1):(pimatic.showToast(__("Sorry, you have no permissions to avtivate the plugin.")),!1)},e.prototype.onDeactivateClick=function(t){return this.hasPermission("plugins","write")?pimatic.client.rest.setPluginActivated({pluginName:t.name,active:!1}).done(function(i){return function(e){if(e.success)return t.activated(!1),i.restartRequired(!0)}}(this)).fail(ajaxAlertFail):(pimatic.showToast(__("Sorry, you have no permissions to deactivate the plugin.")),!1)},e.prototype.onUninstallClick=function(t){return this.hasPermission("plugins","write")?confirm(__("Do you really want to uninstall the %s plugin?",t.name))?pimatic.client.rest.uninstallPlugin({name:"pimatic-"+t.name}).done(function(i){return function(){return i.restartRequired(!0),i.refresh(),confirm(__("Do you want to remove all config options as well?"))?pimatic.client.rest.removePluginFromConfig({pluginName:t.name}).done(function(){return i.refresh()}).fail(ajaxAlertFail):pimatic.client.rest.setPluginActivated({pluginName:t.name,active:!1}).done(function(){return i.refresh()}).fail(ajaxAlertFail)}}(this)).fail(ajaxAlertFail):void 0:(pimatic.showToast(__("Sorry, you have no permissions to uninstall the plugin.")),!1)},e.prototype.onSettingsClick=function(t){return this.hasPermission("plugins","write")?(jQuery.mobile.pageParams={action:"update",pluginName:t.name},!0):(pimatic.showToast(__("Sorry, you have no permissions to edit the plugin.")),!1)},e.prototype.onInstallClick=function(t){var i;return this.hasPermission("updates","write")?(i=["pimatic-"+t.name],pimatic.client.rest.installUpdatesAsync({modules:i}).fail(function(t,i,e){if("timeout"!==i)return ajaxAlertFail(t,i,e)})):(pimatic.showToast(__("Sorry, you have no permissions to install the plugin.")),!1)},e.prototype.getInstalledPluginsWithInfo=function(){return pimatic.client.rest.getInstalledPluginsWithInfo().done(function(t){return function(i){return t.updateFromJs({installedPlugins:i.plugins})}}(this)).fail(ajaxAlertFail)},e.prototype.searchForPluginsWithInfo=function(){return pimatic.client.rest.searchForPluginsWithInfo().done(function(t){return function(i){return t.updateFromJs({browsePlugins:i.plugins})}}(this)).fail(ajaxAlertFail)},e.prototype.doesRequireRestart=function(){return pimatic.client.rest.doesRequireRestart().done(function(t){return function(i){return t.restartRequired(i.restartRequired)}}(this)).fail(ajaxAlertFail)},e.prototype.refresh=function(){return this.getInstalledPluginsWithInfo(),this.searchForPluginsWithInfo(),this.doesRequireRestart()},e}();try{pimatic.pages.plugins=new n}catch(t){s=t,TraceKit.report(s)}}}),$(document).on("pagecreate","#plugins-page",function(t){var i;try{ko.applyBindings(pimatic.pages.plugins,$("#plugins-page")[0])}catch(t){i=t,TraceKit.report(i)}return $("#plugins-page").on("click",".restart-now",function(t,i){return pimatic.client.rest.restart({}).fail(ajaxAlertFail)}),pimatic.socket.on("connect",function(){return console.log()})}),$(document).on("pageinit","#plugins-page",function(t){return pimatic.pages.plugins.refresh()}),$(document).on("pageshow","#plugins-page",function(){return pimatic.socket.on("connect",pimatic.pages.plugins.refresh)}),$(document).on("pagebeforehide","#plugins-page",function(){return pimatic.socket.off("connect",pimatic.pages.plugins.refresh)})}).call(this);